import {performeter} from "common/perfometer"
import {tag} from "common/tag"
import {ColorArrayDisplay} from "sketches/wave_function_collapse/color_array_display"
import {PatternInput} from "sketches/wave_function_collapse/pattern_input"
import {waveFunctionCollapse} from "sketches/wave_function_collapse/wave_function_collapse_algo"
import * as css from "./wave_function_collapse.module.scss"

const islandsSource = [[0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 16754689, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 16771843, 16771843, 16771843, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16771843, 16771843, 14817887, 16771843, 16771843, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 16771843, 16771843, 16771843, 16771843, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16771843, 16771843, 14817887, 16771843, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 16771843, 16771843, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 16754689, 16754689, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898], [0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898, 0x006898]] as const

export function main(root: HTMLElement): void {
	const patternInput = new PatternInput({
		palette: [0x53bc01, 0xffeb03, 0xffa801, 0xf93a1d, 0xe21a5f, 0x572c62, 0xa1ccd3, 0x006898],
		defaultValue: 0x53bc01,
		height: 20,
		width: 20,
		scale: 10
	})

	const display = new ColorArrayDisplay(10)

	root.appendChild(tag({
		class: css["wave-function-collapse-root"]
	}, [
		tag([
			patternInput.root,
			tag({tagName: "button", text: "Collapse!", on: {click: run}})
		]),
		display.root
	]))

	for(let x = 0; x < islandsSource.length; x++){
		const row = islandsSource[x]!
		for(let y = 0; y < row.length; y++){
			patternInput.set(x, y, row[y]!)
		}
	}

	function run(): void {
		const source = patternInput.getPattern()
		const result = waveFunctionCollapse({
			flip: true,
			rotate: true,
			sourceSample: source,
			patternSize: 3,
			randomSeed: 12345,
			resultSize: {width: 50, height: 50}
		})
		display.draw(result)
		performeter.print()
		performeter.reset()
	}
}