function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,s){Object.defineProperty(e,t,{get:n,set:s,enumerable:!0,configurable:!0})}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirebf86;n.register("jfwrQ",(function(s,i){t(s.exports,"main",(()=>f));var o=n("ilwiq"),r=n("iO5IN"),a=n("Z93qb"),l=n("6eZYS"),u=n("euaFP"),h=n("edTLw"),c=n("7sHgZ");let d=null,g=null;function f(t){const n=(0,u.debounce)(100,(()=>async function(t){const n=t.getBoundingClientRect();t.classList.add(a.root??""),d&&(d.remove(),d=null),d=(0,c.tag)({tag:"img",attrs:{src:e(l)},class:a.initialImage}),n.width/n.height>1920/1080?d.style.maxWidth="100vw":d.style.maxHeight="100vh",t.appendChild(d),await(0,r.waitDOMEvent)(d,"load");let s=!1;const i=d.getBoundingClientRect(),u=i.width/n.width,h=i.height/n.height,f=new o.Scene,w=new o.OrthographicCamera(-.5/u,.5/u,-.5/h,.5/h,.1,1e3);w.position.z=2,w.position.x=w.position.y=0,w.lookAt(0,0,0),w.rotateZ(Math.PI);const p=i.height/100>8?100:25,v=Math.ceil(i.height/p),b=Math.ceil(i.width/p),C=new o.WebGLRenderer;C.setSize(n.width,n.height);const y=new o.TextureLoader,M=await y.loadAsync(d.src),P=new o.MeshBasicMaterial({map:M});async function x(){if(!s){s=!0;try{const e=new m(v,b,f,P,w,(()=>C.render(f,w)));await e.run()}finally{s=!1}}}g&&(g.remove(),g=null),g=C.domElement,g.classList.add(a.squaremixCanvas??""),d.after(g),g.addEventListener("click",x),d.remove(),x()}(t)));n(),(0,h.onResize)(t,n)}class m{constructor(e,t,n,s,i,r){this.columnsCount=e,this.rowsCount=t,this.scene=n,this.material=s,this.camera=i,this.render=r,this.disposeables=[],this.colHeights=this.generateColumnHeights(e,t),this.group=new o.Group,this.scene.add(this.group)}async run(){var e,t;this.generateObjects(),await(e=1/4,t=e=>{this.group.rotation.y=Math.PI/2*(1-e+2),this.camera.rotation.z=Math.PI/2*(e+2),this.render()},new Promise(((n,s)=>{let i=0,o=Date.now();const r=()=>{const a=Date.now();try{t(Math.min(1,i))}catch(e){return void s(e)}i<1?requestAnimationFrame(r):n(),i+=e*((a-o)/1e3),o=a};r()}))),this.dispose()}generateColumnHeights(e,t){const n=new Array(e);for(let s=0;s<e;s++){const i=n[s]=new Array(t);for(let n=0;n<t;n++){let t=e-s+3*(2*Math.random()-1);t=Math.min(1,Math.max(0,Math.round(t)/e)),i[n]=t}}return n}generateObjects(){for(let e=0;e<this.colHeights.length;e++)for(let t=0;t<this.colHeights[e].length;t++)this.generateColumnObject(e,t,this.colHeights[e][t]);const e=this.makeAddSlicePlane(0,1,0,1);e.translateX(-.5),e.translateY(-.5),e.translateZ(-.5),e.rotateY(-Math.PI/2)}generateColumnObject(e,t,n){this.addTopPlane(e,t,n),this.addSidePlane(e,t,n)}addSidePlane(e,t,n){if(0===n)return;const s=this.makeAddSlicePlane(1-n,1,t/this.rowsCount,(t+1)/this.rowsCount);s.rotateY(-Math.PI/2),s.translateX(.5-n),s.translateY(t/this.rowsCount-.5),s.translateZ(-(e+1)/this.columnsCount+.5)}addTopPlane(e,t,n){const s=this.makeAddSlicePlane(e/this.columnsCount,(e+1)/this.columnsCount,t/this.rowsCount,(t+1)/this.rowsCount,!0);s.translateX(e/this.columnsCount-.5),s.translateY(t/this.rowsCount-.5),s.translateZ(.5-n)}makeAddSlicePlane(e,t,n,s,i=!1){const r=new o.PlaneGeometry;this.disposeables.push(r);const a=new o.Mesh(r,this.material),l=r.attributes.uv;if(i){const i=1-n,o=1-s,r=e,a=t;for(let e=0;e<l.count;e++)0===l.getX(e)?0===l.getY(e)?l.setXY(e,i,r):l.setXY(e,o,r):0===l.getY(e)?l.setXY(e,i,a):l.setXY(e,o,a)}else for(let i=0;i<l.count;i++)l.setX(i,0===l.getX(i)?e:t),l.setY(i,0===l.getY(i)?n:s);l.needsUpdate=!0;const u=t-e,h=s-n,c=r.attributes.position;for(let e=0;e<c.count;e++)c.setX(e,c.getX(e)<0?0:u),c.setY(e,c.getY(e)<0?0:h);return c.needsUpdate=!0,this.group.add(a),a}dispose(){this.disposeables.forEach((e=>e.dispose())),this.disposeables.length=0,this.scene.remove(this.group)}}})),n.register("iO5IN",(function(e,n){function s(e,t){return new Promise(((n,s)=>{e.addEventListener("error",(e=>s(new Error(e.message)))),e.addEventListener(t,(e=>n(e)))}))}t(e.exports,"waitDOMEvent",(()=>s))})),n.register("Z93qb",(function(e,n){var s,i,o;t(e.exports,"initialImage",(()=>s),(e=>s=e)),t(e.exports,"root",(()=>i),(e=>i=e)),t(e.exports,"squaremixCanvas",(()=>o),(e=>o=e)),s="imgXfq_initialImage",i="imgXfq_root",o="imgXfq_squaremixCanvas"})),n.register("6eZYS",(function(e,t){e.exports=new URL(n("27Lyk").resolve("6fzAl"),import.meta.url).toString()})),n.register("27Lyk",(function(e,n){var s,i;t(e.exports,"register",(()=>s),(e=>s=e)),t(e.exports,"resolve",(()=>i),(e=>i=e));var o={};s=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)o[t[n]]=e[t[n]]},i=function(e){var t=o[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),n.register("euaFP",(function(e,n){function s(e,t){let n=null;return()=>{n||(n="raf"===e?requestAnimationFrame((()=>{n=null,t()})):setTimeout((()=>{n=null,t()}),e))}}t(e.exports,"debounce",(()=>s))})),n.register("edTLw",(function(e,s){t(e.exports,"onResize",(()=>o));var i=n("7sHgZ");function o(e,t){(0,i.onMount)(e,(()=>{const n=new ResizeObserver((n=>{for(const s of n)s.target===e&&(console.log("uwu"),t(s))}));return n.observe(e),()=>n.disconnect()}),{ifInDom:"call"})}}));
//# sourceMappingURL=squaremix_3d.a41ea27c.js.map
