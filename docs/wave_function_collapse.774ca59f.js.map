{"mappings":"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","sources":["src/sketches/wave_function_collapse/wave_function_collapse.ts","src/common/perfometer.ts","src/common/tag.ts","src/common/classname.ts","src/sketches/wave_function_collapse/color_array_display.ts","src/common/color_utils.ts","src/sketches/wave_function_collapse/pattern_input.ts","src/common/input_utils.ts","src/sketches/wave_function_collapse/wave_function_collapse.module.scss","src/sketches/wave_function_collapse/wave_function_collapse_algo.ts","src/common/bitmap.ts","src/sketches/wave_function_collapse/test_result.json","src/sketches/wave_function_collapse/island_small_source.json"],"sourcesContent":["import {performeter} from \"common/perfometer\"\nimport {tag} from \"common/tag\"\nimport {ColorArrayDisplay} from \"sketches/wave_function_collapse/color_array_display\"\nimport {PatternInput} from \"sketches/wave_function_collapse/pattern_input\"\nimport {waveFunctionCollapse} from \"sketches/wave_function_collapse/wave_function_collapse_algo\"\nimport * as css from \"./wave_function_collapse.module.scss\"\nimport * as testResult from \"./test_result.json\"\n// import * as islandsSource from \"./island_source.json\"\nimport * as islandsSource from \"./island_small_source.json\"\n\nexport function main(root: HTMLElement): void {\n\tconst patternInput = new PatternInput<number>({\n\t\tpalette: [0x53bc01, 0xffeb03, 0xffa801, 0xf93a1d, 0xe21a5f, 0x572c62, 0xa1ccd3, 0x006898],\n\t\tdefaultValue: 0x53bc01,\n\t\theight: 10,\n\t\twidth: 10,\n\t\tscale: 10\n\t})\n\n\tconst display = new ColorArrayDisplay(10)\n\n\troot.appendChild(tag({\n\t\tclass: css[\"wave-function-collapse-root\"]\n\t}, [\n\t\ttag([\n\t\t\tpatternInput.root,\n\t\t\ttag({tagName: \"button\", text: \"Collapse!\", on: {click: run}})\n\t\t]),\n\t\tdisplay.root\n\t]))\n\n\tpatternInput.setValue(islandsSource)\n\n\tfunction run(): void {\n\t\tconst source = patternInput.getPattern()\n\t\tconsole.log(JSON.stringify(source))\n\t\tconst result = waveFunctionCollapse({\n\t\t\tflip: true,\n\t\t\trotate: true,\n\t\t\tsourceSample: source,\n\t\t\tpatternSize: 3,\n\t\t\trandomSeed: 12345,\n\t\t\tresultSize: {width: 30, height: 30}\n\t\t})\n\t\tdisplay.draw(result)\n\t\t// checkResult(result)\n\t\tperformeter.print()\n\t\tperformeter.reset()\n\t}\n}\n\nvoid checkResult\nfunction checkResult(result: number[][]): void {\n\tif(JSON.stringify(result) !== JSON.stringify(testResult)){\n\t\tconsole.error(\"Results are different!\")\n\t} else {\n\t\tconsole.log(\"Results are the same.\")\n\t}\n}","interface Block {\n\tparent: Block | null\n\tsubblocks: Record<string, Block>\n\ttimeStart: number\n\ttimeSum: number\n\tenterCount: number\n}\n\ninterface BlockToPrint {\n\t\"ms per enter\": number\n\t\"full %\": number\n\t\"parent %\": number\n}\n\nclass Perfometer {\n\n\tprivate root: Block = this.makeBlock(null)\n\tprivate currentBlock: Block = this.root\n\tprivate eventCounters: Record<string, number> = {}\n\n\tprivate makeBlock(parent: Block | null): Block {\n\t\treturn {\n\t\t\tsubblocks: {}, parent: parent,\n\t\t\ttimeStart: -1, timeSum: 0,\n\t\t\tenterCount: 0\n\t\t}\n\t}\n\n\tenterBlock(name: string): void {\n\t\tlet nextBlock = this.currentBlock.subblocks[name]\n\t\tif(!nextBlock){\n\t\t\tnextBlock = this.makeBlock(this.currentBlock)\n\t\t\tthis.currentBlock.subblocks[name] = nextBlock\n\t\t}\n\t\tnextBlock.timeStart = performance.now()\n\t\tnextBlock.enterCount++\n\t\tthis.currentBlock = nextBlock\n\t}\n\n\trecordEvent(name: string): void {\n\t\tthis.eventCounters[name] = (this.eventCounters[name] ?? 0) + 1\n\t}\n\n\texitBlock(): void {\n\t\tthis.currentBlock.timeSum += performance.now() - this.currentBlock.timeStart\n\t\tconst parent = this.currentBlock.parent\n\t\tif(!parent){\n\t\t\tthrow new Error(\"No parent! Blocks are all messed up.\")\n\t\t}\n\t\tthis.currentBlock = parent\n\t}\n\n\texitEnterBlock(name: string): void {\n\t\tthis.exitBlock()\n\t\tthis.enterBlock(name)\n\t}\n\n\tprint(): void {\n\t\tconst table: Record<string, BlockToPrint> = {}\n\t\tlet fullTime = 0\n\t\tfor(const name in this.root.subblocks){\n\t\t\tfullTime += this.root.subblocks[name]!.timeSum\n\t\t}\n\n\t\tthis.forEachBlock((block, name, depth) => {\n\t\t\tname = new Array(depth + 1).join(\"-\") + name\n\t\t\ttable[name] = {\n\t\t\t\t\"parent %\": strip((block.timeSum / block.parent!.timeSum) * 100),\n\t\t\t\t\"full %\": strip((block.timeSum / fullTime) * 100),\n\t\t\t\t\"ms per enter\": strip(block.timeSum / block.enterCount)\n\t\t\t}\n\t\t})\n\n\t\tconsole.table(table)\n\t\tconsole.table(this.eventCounters)\n\t}\n\n\treset(): void {\n\t\tthis.root = this.makeBlock(null)\n\t\tthis.currentBlock = this.root\n\t\tthis.eventCounters = {}\n\t}\n\n\tprivate forEachBlock(callback: (block: Block, name: string, depth: number) => void, start: Block = this.root, currentDepth = 0): void {\n\t\tfor(const name in start.subblocks){\n\t\t\tconst subblock = start.subblocks[name]!\n\t\t\tcallback(subblock, name, currentDepth)\n\t\t\tthis.forEachBlock(callback, subblock, currentDepth + 1)\n\t\t}\n\t}\n\n}\n\nexport const performeter = new Perfometer()\n\nfunction strip(v: number): number {\n\treturn Math.round(v * 100) / 100\n}","import {Binder, getBinder} from \"common/binder/binder\"\nimport {isRBox, MaybeRBoxed, RBox, unbox, WBox} from \"common/box\"\nimport {ClassNameParts, makeClassname} from \"common/classname\"\nimport {FieldsOfObjectWithType, WritableKeysOf} from \"common/type_utils\"\n\ntype CssStyleAssignableKeys = WritableKeysOf<CSSStyleDeclaration> & FieldsOfObjectWithType<CSSStyleDeclaration, string>\n\ninterface TagDescription<K extends string = string, ThisType = unknown> {\n\treadonly tagName?: K\n\treadonly text?: MaybeRBoxed<string | number>\n\treadonly attrs?: {\n\t\treadonly [attrName: string]: MaybeRBoxed<string | number | undefined | null>\n\t}\n\treadonly on?: {\n\t\treadonly [k in keyof GlobalEventHandlersEventMap]?: (this: ThisType, evt: GlobalEventHandlersEventMap[k]) => void\n\t}\n\treadonly class?: ClassNameParts\n}\n\nexport interface HTMLTagDescription<K extends keyof HTMLElementTagNameMap = keyof HTMLElementTagNameMap> extends TagDescription<K, HTMLElementTagNameMap[K]> {\n\n\treadonly style?: {\n\t\treadonly [k in CssStyleAssignableKeys]?: MaybeRBoxed<string | number>\n\t}\n}\n\nexport type SVGTagDescription<K extends keyof SVGElementTagNameMap = keyof SVGElementTagNameMap> = TagDescription<K, SVGElementTagNameMap[K]>\n\ntype ChildArray = (Element | null | undefined)[] | RBox<(Element | null | undefined)[]>\n\n// typings are weird here, had to cast\nfunction resolveArgs<K>(a?: K | ChildArray, b?: ChildArray): [K, ChildArray | undefined] {\n\tif(!a){\n\t\treturn [{} as K, b]\n\t} else if(Array.isArray(a) || isRBox(a)){\n\t\treturn [{} as K, a as ChildArray]\n\t} else {\n\t\treturn [a as K, b]\n\t}\n}\n\nfunction populateTag<K extends string, T>(tagBase: Element, description: TagDescription<K, T>, children?: ChildArray): Binder | null {\n\tlet binder: Binder | null = null\n\n\tif(description.text){\n\t\tconst text = description.text\n\t\tif(isRBox(text)){\n\t\t\t(binder ||= getBinder(tagBase)).watch<string | number>(text, text => {\n\t\t\t\ttagBase.textContent = text + \"\"\n\t\t\t})\n\t\t}\n\t\ttagBase.textContent = unbox(text) + \"\"\n\t}\n\n\tif(description.on){\n\t\tfor(const evtName in description.on){\n\t\t\tconst handler = description.on[evtName as keyof GlobalEventHandlersEventMap]\n\t\t\t// I don't want to construct elaborat solid type here\n\t\t\t// I know the type will be correct, because it is enforced by function parameter type\n\t\t\t// so just be Any and that's it\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\ttagBase.addEventListener(evtName, handler as any, {passive: true, capture: false})\n\t\t}\n\t}\n\n\tfor(const k in description.attrs){\n\t\tconst v = description.attrs[k]\n\t\tif(isRBox(v)){\n\t\t\t(binder ||= getBinder(tagBase)).watch<string | number | null | undefined>(v, v => {\n\t\t\t\tif(v === null || v === undefined){\n\t\t\t\t\ttagBase.removeAttribute(k)\n\t\t\t\t} else {\n\t\t\t\t\ttagBase.setAttribute(k, v + \"\")\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tconst vv = unbox(v)\n\t\tif(v !== null && v !== undefined){\n\t\t\ttagBase.setAttribute(k, vv + \"\")\n\t\t}\n\t}\n\n\tif(children){\n\t\tconst setChildren = (children: (Element | null | undefined)[]) => {\n\t\t\tconst childTags = children.filter(x => !!x) as Element[]\n\t\t\tupdateChildren(tagBase, childTags)\n\t\t}\n\n\t\tif(isRBox(children)){\n\t\t\t(binder ||= getBinder(tagBase)).watch(children, children => {\n\t\t\t\tsetChildren(children)\n\t\t\t})\n\t\t}\n\t\tsetChildren(unbox(children))\n\t}\n\n\tif(description.class){\n\t\tbinder = makeClassname(\n\t\t\tbinder,\n\t\t\ttagBase,\n\t\t\tdescription.class,\n\t\t\t// using classList here because on svg elements .className is readonly (in runtime)\n\t\t\tclassname => tagBase.classList.value = classname\n\t\t) || binder\n\t}\n\n\treturn binder\n}\n\nexport function tag(): HTMLDivElement\nexport function tag<K extends keyof HTMLElementTagNameMap = \"div\">(description: HTMLTagDescription<K>): HTMLElementTagNameMap[K]\nexport function tag(children: ChildArray): HTMLDivElement\nexport function tag<K extends keyof HTMLElementTagNameMap = \"div\">(description: HTMLTagDescription<K>, children: ChildArray): HTMLElementTagNameMap[K]\n\nexport function tag<K extends keyof HTMLElementTagNameMap = \"div\">(a?: HTMLTagDescription<K> | ChildArray, b?: ChildArray): HTMLElementTagNameMap[K] {\n\tconst [description, children] = resolveArgs(a, b)\n\n\tconst tagBase = document.createElement(description.tagName || \"div\")\n\n\tlet binder = populateTag(tagBase, description, children)\n\n\tif(description.style){\n\t\tfor(const k in description.style){\n\t\t\tconst v = description.style[k as CssStyleAssignableKeys]\n\t\t\tif(isRBox(v)){\n\t\t\t\t(binder ||= getBinder(tagBase)).watch<string | number>(v, v => {\n\t\t\t\t\ttagBase.style[k] = v + \"\"\n\t\t\t\t})\n\t\t\t}\n\t\t\ttagBase.style[k] = unbox(description.style[k]!) + \"\"\n\t\t}\n\t}\n\n\treturn tagBase as HTMLElementTagNameMap[K]\n}\n\nexport function svgTag(): SVGGElement\nexport function svgTag<K extends keyof SVGElementTagNameMap = \"g\">(description: SVGTagDescription<K>): SVGElementTagNameMap[K]\nexport function svgTag(children: ChildArray): SVGGElement\nexport function svgTag<K extends keyof SVGElementTagNameMap = \"g\">(description: SVGTagDescription<K>, children: ChildArray): SVGElementTagNameMap[K]\n\nexport function svgTag<K extends keyof SVGElementTagNameMap = \"g\">(a?: SVGTagDescription<K> | ChildArray, b?: ChildArray): SVGElementTagNameMap[K] {\n\tconst [description, children] = resolveArgs(a, b)\n\n\tconst tagBase = document.createElementNS(\"http://www.w3.org/2000/svg\", description.tagName || \"g\")\n\n\tif(description.tagName === \"svg\"){\n\t\ttagBase.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\")\n\t}\n\n\tpopulateTag(tagBase, description, children)\n\n\treturn tagBase as SVGElementTagNameMap[K]\n}\n\nfunction updateChildren(parent: Element, newChildren: readonly Element[]): void {\n\tfor(let i = 0; i < newChildren.length; i++){\n\t\tconst childTag = newChildren[i]!\n\t\tconst x = parent.childNodes[i]\n\t\tif(x === childTag){\n\t\t\tcontinue\n\t\t}\n\t\tif(x){\n\t\t\tparent.insertBefore(childTag, x)\n\t\t} else {\n\t\t\tparent.appendChild(childTag)\n\t\t}\n\t}\n\n\twhile(parent.childNodes[newChildren.length]){\n\t\tparent.childNodes[newChildren.length]!.remove()\n\t}\n}\n\n/** Cached renderer for list of elements\n * Won't re-render an element if already has one for the value */\nexport function renderArray<T, K, E extends Element>(src: WBox<T[]>, getKey: (value: T) => K, render: (value: WBox<T>) => E): RBox<E[]>\nexport function renderArray<T, K, E extends Element>(src: RBox<T[]>, getKey: (value: T) => K, render: (value: RBox<T>) => E): RBox<E[]>\nexport function renderArray<T, K, E extends Element>(src: MaybeRBoxed<readonly T[]>, getKey: (value: T) => K, render: (value: MaybeRBoxed<T>) => E): E[]\nexport function renderArray<T, K, E extends Element>(src: MaybeRBoxed<readonly T[]> | WBox<T[]>, getKey: (value: T) => K, render: (value: WBox<T> | T) => E): Node[] | RBox<Node[]> {\n\tif(Array.isArray(src)){\n\t\treturn src.map(el => render(el))\n\t}\n\n\tconst map = new Map<WBox<T>, E>()\n\n\treturn (src as WBox<T[]>).wrapElements(getKey).map(itemBoxes => {\n\t\tconst leftoverBoxes = new Set(map.keys())\n\n\t\tconst result = itemBoxes.map(itemBox => {\n\t\t\tleftoverBoxes.delete(itemBox)\n\t\t\tlet el = map.get(itemBox)\n\t\t\tif(!el){\n\t\t\t\tel = render(itemBox)\n\t\t\t\tmap.set(itemBox, el)\n\t\t\t}\n\t\t\treturn el\n\t\t})\n\n\t\tfor(const oldBox of leftoverBoxes){\n\t\t\tmap.delete(oldBox)\n\t\t}\n\n\t\treturn result\n\t})\n}","import {Binder, getBinder} from \"common/binder/binder\"\nimport {isRBox, MaybeRBoxed, unbox} from \"common/box\"\n\ntype ClassNamePart = MaybeRBoxed<string | null | undefined> | Record<string, MaybeRBoxed<boolean | undefined>>\nexport type ClassNameParts = ClassNamePart | ClassNamePart[]\n\n/** Utility function that assembles classname from parts */\nexport function makeClassname(binder: Binder | null, node: Node, parts: ClassNameParts, callback: (className: string) => void): Binder | null {\n\tconst arr = Array.isArray(parts) ? parts : [parts]\n\tfor(const item of arr){\n\t\tif(isRBox(item)){\n\t\t\t(binder ||= getBinder(node)).watch(item, makeClassnameAndCallTheCallback)\n\t\t} else if(item && typeof(item) === \"object\"){\n\t\t\tfor(const key in item){\n\t\t\t\tconst bool = item[key]\n\t\t\t\tif(isRBox(bool)){\n\t\t\t\t\t(binder ||= getBinder(node)).watch(bool, makeClassnameAndCallTheCallback)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction makeClassnameAndCallTheCallback() {\n\t\tconst result = []\n\t\tfor(const item of arr){\n\t\t\tif(item && typeof(item) === \"object\"){\n\t\t\t\tfor(const classname in item){\n\t\t\t\t\tif(unbox(item[classname])){\n\t\t\t\t\t\tresult.push(classname)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst classname = unbox(item)\n\t\t\t\tif(classname){\n\t\t\t\t\tresult.push(classname)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcallback(result.join(\" \"))\n\t}\n\n\tmakeClassnameAndCallTheCallback()\n\n\treturn binder\n}","import {rgbNumberToColorString} from \"common/color_utils\"\nimport {tag} from \"common/tag\"\n\nexport class ColorArrayDisplay {\n\n\treadonly root: HTMLElement\n\tprivate readonly context: CanvasRenderingContext2D\n\n\tconstructor(readonly scale: number) {\n\t\tconst canvas = tag({tagName: \"canvas\"})\n\t\tthis.root = canvas\n\n\t\tconst context = canvas.getContext(\"2d\")\n\t\tif(!context){\n\t\t\tthrow new Error(\"No context\")\n\t\t}\n\t\tthis.context = context\n\t}\n\n\tdraw(values: readonly (readonly number[])[]): void {\n\t\tconst w = values.length * this.scale\n\t\tconst h = values[0]!.length * this.scale\n\t\tthis.root.setAttribute(\"width\", w + \"\")\n\t\tthis.root.setAttribute(\"height\", h + \"\")\n\t\tthis.root.style.width = w + \"px\"\n\t\tthis.root.style.height = h + \"px\"\n\n\t\tconst s = this.scale\n\t\tfor(let x = 0; x < values.length; x++){\n\t\t\tconst row = values[x]!\n\t\t\tfor(let y = 0; y < row.length; y++){\n\t\t\t\tthis.context.fillStyle = rgbNumberToColorString(row[y]!)\n\t\t\t\tthis.context.fillRect(x * s, y * s, s, s)\n\t\t\t}\n\t\t}\n\t}\n\n}","function twoHex(x: number): string {\n\treturn (x > 0xf ? \"\" : \"0\") + x.toString(16)\n}\n\nexport function colorNumberTo3Components(color: number): [r: number, g: number, b: number] {\n\tconst r = (color >> 16) & 0xff,\n\t\tg = (color >> 8) & 0xff,\n\t\tb = (color >> 0) & 0xff\n\treturn [r, g, b]\n}\n\nexport function color3ComponentsToNumber(components: [r: number, g: number, b: number]): number {\n\tconst [r, g, b] = components\n\treturn (r << 16) | (g << 8) | b\n}\n\nexport function rgbToHsl(color: number): number {\n\tlet [r, g, b] = colorNumberTo3Components(color)\n\t// Make r, g, and b fractions of 1\n\tr /= 255\n\tg /= 255\n\tb /= 255\n\n\t// Find greatest and smallest channel values\n\tconst cmin = Math.min(r, g, b),\n\t\tcmax = Math.max(r, g, b),\n\t\tdelta = cmax - cmin\n\tlet h = 0,\n\t\ts = 0,\n\t\tl = 0\n\n\t// Calculate hue\n\t// No difference\n\tif(delta === 0){\n\t\th = 0\n\t} else if(cmax === r){\n\t\t// Red is max\n\t\th = ((g - b) / delta) % 6\n\t} else if(cmax === g){\n\t\t// Green is max\n\t\th = (b - r) / delta + 2\n\t} else {\n\t\t// Blue is max\n\t\th = (r - g) / delta + 4\n\t}\n\n\th = Math.round(h * 60)\n\n\t// Make negative hues positive behind 360Â°\n\tif(h < 0){\n\t\th += 360\n\t}\n\n\t// Calculate lightness\n\tl = (cmax + cmin) / 2\n\n\t// Calculate saturation\n\ts = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1))\n\n\t// Multiply l and s by 100\n\ts = +(s * 100).toFixed(1)\n\tl = +(l * 100).toFixed(1)\n\n\treturn color3ComponentsToNumber([(h / 360) * 255, (s / 100) * 255, (l / 100) * 255])\n}\n\nexport function hslToRgb(hsl: number): number {\n\tlet [h, s, l] = colorNumberTo3Components(hsl)\n\th /= 255\n\ts /= 255\n\tl /= 255\n\tlet r: number, g: number, b: number\n\n\tif(s === 0){\n\t\tr = g = b = l // achromatic\n\t} else {\n\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s\n\t\tconst p = 2 * l - q\n\t\tr = hueToRgb(p, q, h + 1 / 3)\n\t\tg = hueToRgb(p, q, h)\n\t\tb = hueToRgb(p, q, h - 1 / 3)\n\t}\n\n\treturn color3ComponentsToNumber([Math.floor(r * 255), Math.floor(g * 255), Math.floor(b * 255)])\n}\n\nfunction hueToRgb(p: number, q: number, t: number): number {\n\tif(t < 0){\n\t\tt += 1\n\t}\n\tif(t > 1){\n\t\tt -= 1\n\t}\n\tif(t < 1 / 6){\n\t\treturn p + (q - p) * 6 * t\n\t}\n\tif(t < 1 / 2){\n\t\treturn q\n\t}\n\tif(t < 2 / 3){\n\t\treturn p + (q - p) * (2 / 3 - t) * 6\n\t}\n\treturn p\n}\n\nexport function rgbNumberToColorString(rgb: number): string {\n\tconst b = rgb & 0xff\n\trgb >>= 8\n\tconst g = rgb & 0xff\n\trgb >>= 8\n\tconst r = rgb & 0xff\n\n\treturn \"#\" + twoHex(r) + twoHex(g) + twoHex(b)\n}\n\nexport function transformColorHsl(colorRgb: number, transform: (hsl: [number, number, number]) => [number, number, number]): number {\n\tconst transformResult = transform(\n\t\tcolorNumberTo3Components(\n\t\t\trgbToHsl(colorRgb)\n\t\t)\n\t)\n\ttransformResult[0] = Math.max(0, Math.min(255, transformResult[0]))\n\ttransformResult[1] = Math.max(0, Math.min(255, transformResult[1]))\n\ttransformResult[2] = Math.max(0, Math.min(255, transformResult[2]))\n\treturn hslToRgb(\n\t\tcolor3ComponentsToNumber(\n\t\t\ttransformResult\n\t\t)\n\t)\n}","import {rgbNumberToColorString} from \"common/color_utils\"\nimport {addCursorMoveHandler, pointerEventsToOffsetCoords, preventContextMenu} from \"common/input_utils\"\nimport {tag} from \"common/tag\"\nimport {ColorArrayDisplay} from \"sketches/wave_function_collapse/color_array_display\"\nimport * as css from \"./wave_function_collapse.module.scss\"\n\ntype PatternInputParams<T extends number = number> = {\n\treadonly palette: readonly T[]\n\treadonly defaultValue: T\n\treadonly width: number\n\treadonly height: number\n\treadonly scale: number\n}\n\ntype ColorButton<T extends number = number> = {\n\tbutton: HTMLElement\n\tcolor: T\n\tclassName: string\n}\n\nexport class PatternInput<T extends number = number> {\n\treadonly root: HTMLElement\n\n\tprivate readonly display: ColorArrayDisplay\n\tprivate pattern: readonly (T[])[]\n\tprivate primaryCb: ColorButton<T> | null = null\n\t// I had logic around having secondary color on right mouse button\n\t// but turns out mouseevent.buttons can be weird\n\t// so, whatever, I'm not solving this now\n\t// private secondaryCb: ColorButton<T> | null = null\n\n\tconstructor(private readonly params: PatternInputParams<T>) {\n\t\tthis.display = new ColorArrayDisplay(params.scale)\n\n\t\tpreventContextMenu(this.display.root)\n\t\taddCursorMoveHandler({\n\t\t\telement: this.display.root,\n\t\t\tonMove: this.onSetColorAction.bind(this),\n\t\t\tdownIsMove: true\n\t\t})\n\n\t\tthis.pattern = new Array(params.width).fill(null).map(() =>\n\t\t\tnew Array(params.height).fill(params.defaultValue)\n\t\t)\n\n\t\tconst paletteButtons = params.palette.map(color => {\n\t\t\tconst button: HTMLElement = tag({\n\t\t\t\tclass: css[\"pattern-input-palette-item\"],\n\t\t\t\ton: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.primaryCb = this.selectColor(this.primaryCb, button, color)\n\t\t\t\t\t}\n\t\t\t\t\t// contextmenu: () => {\n\t\t\t\t\t// \tthis.secondaryCb = this.selectColor(this.secondaryCb, button, color)\n\t\t\t\t\t// }\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\tbackgroundColor: rgbNumberToColorString(color)\n\t\t\t\t}\n\t\t\t})\n\t\t\tpreventContextMenu(button)\n\t\t\tif(color === this.params.defaultValue){\n\t\t\t\tthis.primaryCb = this.selectColor(null, button, color, css[\"selected-primary\"]!)\n\t\t\t\t// this.secondaryCb = this.selectColor(null, button, color, css[\"selected-secondary\"]!)\n\t\t\t}\n\t\t\treturn button\n\t\t})\n\n\t\tthis.root = tag({\n\t\t\tclass: css[\"pattern-input-wrap\"]\n\t\t}, [\n\t\t\tthis.display.root,\n\t\t\ttag({\n\t\t\t\tclass: css[\"pattern-input-palette-wrap\"]\n\t\t\t}, paletteButtons)\n\t\t])\n\n\t\tthis.redrawCanvas()\n\t}\n\n\tprivate redrawCanvas(): void {\n\t\tthis.display.draw(this.pattern)\n\t}\n\n\tprivate onSetColorAction(e: MouseEvent | TouchEvent): void {\n\t\tconst coords = pointerEventsToOffsetCoords(e)\n\t\tif(!coords){\n\t\t\treturn\n\t\t}\n\t\t// let isPrimary: boolean\n\t\t// if(isTouchEvent(e)){\n\t\t// \tisPrimary = true\n\t\t// } else {\n\t\t// \tisPrimary = e.buttons !== 2\n\t\t// }\n\t\tconst cellX = Math.floor(coords.x / this.params.scale)\n\t\tconst cellY = Math.floor(coords.y / this.params.scale)\n\t\tconst row = this.pattern[cellX]\n\t\tif(row && row.length > cellY){\n\t\t\t// const cb = isPrimary ? this.primaryCb : this.secondaryCb\n\t\t\tconst cb = this.primaryCb\n\t\t\tif(cb){\n\t\t\t\tthis.set(cellX, cellY, cb.color)\n\t\t\t}\n\t\t}\n\t}\n\n\tsetValue(values: T[][]): void {\n\t\tthis.pattern = JSON.parse(JSON.stringify(values))\n\t\tthis.redrawCanvas()\n\t}\n\n\tset(x: number, y: number, color: T): void {\n\t\tthis.pattern[x]![y] = color\n\t\tthis.redrawCanvas()\n\t}\n\n\tprivate selectColor(prevCb: ColorButton<T> | null, button: HTMLElement, color: T, dfltClassName = \"selected\"): ColorButton<T> {\n\t\tconst clsName = prevCb?.className ?? dfltClassName\n\t\tif(prevCb){\n\t\t\tprevCb.button.classList.remove(clsName)\n\t\t}\n\t\tconst cb: ColorButton<T> = {\n\t\t\tbutton,\n\t\t\tcolor,\n\t\t\tclassName: clsName\n\t\t}\n\t\tbutton.classList.add(clsName)\n\t\treturn cb\n\t}\n\n\tgetPattern(): number[][] {\n\t\treturn JSON.parse(JSON.stringify(this.pattern))\n\t}\n}","export function pointerEventsToClientCoords(e: MouseEvent | TouchEvent): {x: number, y: number} {\n\tif(isTouchEvent(e)){\n\t\tconst touch = e.touches[0]!\n\t\treturn {\n\t\t\tx: touch.clientX,\n\t\t\ty: touch.clientY\n\t\t}\n\t} else {\n\t\treturn {\n\t\t\tx: e.clientX,\n\t\t\ty: e.clientY\n\t\t}\n\t}\n}\n\nexport function pointerEventsToOffsetCoords(e: MouseEvent | TouchEvent): {x: number, y: number} | null {\n\tif(!(e.target instanceof HTMLElement)){\n\t\treturn null\n\t}\n\n\tconst rect = e.target.getBoundingClientRect() // performance may suck, but whatever\n\tconst coords = pointerEventsToClientCoords(e)\n\tcoords.x -= rect.left\n\tcoords.y -= rect.top\n\treturn coords\n}\n\nexport function isTouchEvent(e: MouseEvent | TouchEvent): e is TouchEvent {\n\treturn !!(e as TouchEvent).touches\n}\n\ntype CursorMoveHandlerParams = {\n\treadonly element: HTMLElement\n\tonMove(e: MouseEvent | TouchEvent): void\n\t/** If true, onMove will be invoked when down event happen */\n\treadonly downIsMove?: boolean\n\t/** If true, onMove will be invoked when up event happen */\n\treadonly upIsMove?: boolean\n}\n\n/** This is a good way to add a mousemove handler to an element */\nexport function addCursorMoveHandler(params: CursorMoveHandlerParams): void {\n\n\tconst onDown = (e: MouseEvent | TouchEvent) => {\n\t\twindow.addEventListener(\"mousemove\", params.onMove, {passive: true})\n\t\twindow.addEventListener(\"touchmove\", params.onMove, {passive: true})\n\t\twindow.addEventListener(\"mouseup\", onUp, {passive: true})\n\t\twindow.addEventListener(\"touchend\", onUp, {passive: true})\n\t\tif(params.downIsMove){\n\t\t\tparams.onMove(e)\n\t\t}\n\t}\n\n\tconst onUp = (e: MouseEvent | TouchEvent) => {\n\t\twindow.removeEventListener(\"mousemove\", params.onMove)\n\t\twindow.removeEventListener(\"touchmove\", params.onMove)\n\t\twindow.removeEventListener(\"mouseup\", onUp)\n\t\twindow.removeEventListener(\"touchend\", onUp)\n\t\tif(params.upIsMove){\n\t\t\tparams.onMove(e)\n\t\t}\n\t}\n\n\tparams.element.addEventListener(\"mousedown\", onDown, {passive: true})\n\tparams.element.addEventListener(\"touchstart\", onDown, {passive: true})\n}\n\nexport function preventContextMenu(el: HTMLElement): void {\n\tel.addEventListener(\"contextmenu\", e => {\n\t\te.preventDefault()\n\t\te.stopPropagation()\n\t\treturn false\n\t})\n}",".wave-function-collapse-root {\n\tdisplay: flex;\n\twidth: 100%;\n\theight: 100%;\n\tflex-direction: row;\n\talign-items: center;\n\n\t.pattern-input-wrap {\n\t\tpadding: 1rem;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex-grow: 0;\n\t\tflex-shrink: 0;\n\t\tmargin-right: 1rem;\n\t}\n\n\t.pattern-input-palette-item {\n\t\twidth: 1.5rem;\n\t\theight: 1.5rem;\n\t\tcursor: pointer;\n\t\tborder: 2px solid #222;\n\t\tborder-radius: 3px;\n\n\t\t&.selected-secondary {\n\t\t\tborder: 3px solid #999;\n\t\t}\n\n\t\t&.selected-primary {\n\t\t\tborder: 3px solid #ccc;\n\t\t}\n\t}\n\n\t.pattern-input-palette-wrap {\n\t\tpadding-top: 1rem;\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\t\tjustify-content: center;\n\t\tflex-wrap: wrap;\n\t}\n\n}","import {Bitmap} from \"common/bitmap\"\nimport {performeter} from \"common/perfometer\"\n\ntype WaveFunctionCollapseInput<T = unknown> = {\n\t/** The source sample, from which patterns will be extracted\n\t * indexing: sourceSample[x][y]\n\t * You MUST use same referencially-equal values to represent same logical values\n\t * (that is, if you have two of the same cat in the source - they must both be represented by single instance)\n\t * (this can only matter if you use objects or something like that as T)\n\t * (otherwise it will screw up the pattern extraction) */\n\tsourceSample: T[][]\n\tpatternSize: number\n\tresultSize: {height: number, width: number}\n\tflip: boolean\n\trotate: boolean\n\trandomSeed: number\n}\n\nexport function waveFunctionCollapse<T>(params: WaveFunctionCollapseInput<T>): T[][] {\n\tperformeter.enterBlock(\"init stage\")\n\tconst {patterns, matrix} = init(params)\n\tperformeter.exitEnterBlock(\"collapse stage\")\n\n\twhile(!matrix.isEverythingCollapsed()){\n\t\tperformeter.enterBlock(\"search\")\n\t\tconst lowestEntropyPoint = matrix.findMinEntropyCell()\n\t\tif(!lowestEntropyPoint){\n\t\t\tthrow new Error(\"No lowest entropy point!\")\n\t\t}\n\t\tperformeter.exitEnterBlock(\"collapse\")\n\t\tmatrix.collapse(lowestEntropyPoint)\n\t\tperformeter.exitBlock()\n\t}\n\n\tconst patternIndices = matrix.getResults()\n\n\tperformeter.exitBlock()\n\n\treturn patternIndices.map(row => row.map(patternIndex => {\n\t\tconst pattern = patterns[patternIndex]!\n\t\treturn pattern[0]![0]!\n\t}))\n}\n\ntype XY = {x: number, y: number}\ntype PatternData<T = unknown> = readonly (readonly T[])[]\n// Array(pattern index -> Map(encoded offset -> list of available pattern indices for that offset))\ntype Rules = Map<number, Bitmap>[]\ntype InitResult<T> = {\n\tmatrix: Matrix\n\toffsets: XY[]\n\tpatterns: PatternData<T>[]\n\tpatternsFreq: number[]\n\trules: Rules\n\trandom(): number\n}\n\n/** Performs the initialization phase of the wfc algorithm, namely - aggregate the patterns from the input_examples image, calculate their frequencies and initiate the coefficient_matrix */\nfunction init<T>(params: WaveFunctionCollapseInput<T>): InitResult<T> {\n\tconst offsets = generateOffsets(params.patternSize)\n\tconst [patterns, patternsFreq] = generatePatternsAndFrequences(params)\n\tconst rules = getRules(patterns, offsets)\n\tconst random = makeRandom(params.randomSeed)\n\tconst matrix = new Matrix(params.resultSize.width, params.resultSize.height, patterns.length, random, rules, offsets, patternsFreq)\n\t// console.log(\"Rules: \", rules)\n\treturn {offsets, patterns, patternsFreq, rules, matrix, random}\n}\n\nfunction getRules<T>(patterns: PatternData<T>[], offsets: XY[]): Rules {\n\tconst result: Rules = new Array(patterns.length).fill(null).map(() => {\n\t\tconst patternsByOffset = new Map<number, Bitmap>(offsets.map(offset => [encodeOffset(offset), new Bitmap(patterns.length)]))\n\t\treturn patternsByOffset\n\t})\n\t// console.log(\"Patterns\", patterns)\n\n\tfor(const offset of offsets){\n\t\tconst encodedOffset = encodeOffset(offset)\n\t\t// console.log(`Encoded offset (${offset.x}, ${offset.y}) as ${encodedOffset}`)\n\t\tconst flipEncodedOffset = encodeOffset(flipOffset(offset))\n\t\tfor(let aIndex = 0; aIndex < patterns.length; aIndex++){\n\t\t\tconst a = patterns[aIndex]!\n\t\t\tfor(let bIndex = aIndex; bIndex < patterns.length; bIndex++){\n\t\t\t\tconst b = patterns[bIndex]!\n\t\t\t\tif(patternsHaveMatch(a, b, offset)){\n\t\t\t\t\tresult[aIndex]!.get(encodedOffset)!.set(bIndex)\n\t\t\t\t\tresult[bIndex]!.get(flipEncodedOffset)!.set(aIndex)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result\n}\n\nfunction patternsHaveMatch<T>(a: PatternData<T>, b: PatternData<T>, offset: XY): boolean {\n\tconst patternSize = a.length\n\tconst intersectionLengthX = patternSize - Math.abs(offset.x)\n\tconst intersectionLengthY = patternSize - Math.abs(offset.y)\n\n\tconst startXA = Math.min(Math.max(offset.x, 0), patternSize - intersectionLengthX)\n\tconst startYA = Math.min(Math.max(offset.y, 0), patternSize - intersectionLengthY)\n\tconst startXB = Math.min(Math.max(-offset.x, 0), patternSize - intersectionLengthX)\n\tconst startYB = Math.min(Math.max(-offset.y, 0), patternSize - intersectionLengthY)\n\n\tfor(let dx = 0; dx < intersectionLengthX; dx++){\n\t\tfor(let dy = 0; dy < intersectionLengthY; dy++){\n\t\t\tif(a[startXA + dx]![startYA + dy] !== b[startXB + dx]![startYB + dy]){\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t}\n\treturn true\n}\n\nfunction flipOffset(offset: XY): XY {\n\treturn {x: -offset.x, y: -offset.y}\n}\n\n/** Get the coordinates around a pattern.\n * This function returns a list of all coordinates around a pattern of given size, starting from the top left and ending at the bottom right. The center point (0, 0) is excluded from the list. */\nfunction generateOffsets(patternSize: number): XY[] {\n\tconst result: XY[] = []\n\tfor(let x = -patternSize + 1; x < patternSize; x++){\n\t\tfor(let y = -patternSize + 1; y < patternSize; y++){\n\t\t\tif(x === 0 && y === 0){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tresult.push({x, y})\n\t\t}\n\t}\n\treturn result\n}\n\nfunction encodeOffset(offset: XY): number {\n\treturn Math.abs(offset.x) << 18 | Math.abs(offset.y) << 2 | (offset.y < 0 ? 0x1 : 0) | (offset.x < 0 ? 0x2 : 0)\n}\n\nfunction encodePosition(position: XY): number {\n\treturn position.x << 16 | position.y\n}\n\nfunction decodePosition(position: number): XY {\n\treturn {\n\t\tx: (position >> 16) & 0xffff,\n\t\ty: position & 0xffff\n\t}\n}\n\nfunction normalizeArray(input: number[]): number[] {\n\tconst sum = input.reduce((a, b) => a + b, 0)\n\treturn input.map(x => x / sum)\n}\n\nfunction generatePatternsAndFrequences<T>(params: WaveFunctionCollapseInput<T>): [PatternData<T>[], number[]] {\n\tlet patterns = getPatternDataFromSource(params)\n\n\tconst hashMap = new Map<number, (PatternData<T> | null)[]>()\n\tconst hasher = new PatternHasher(params.sourceSample)\n\tfor(const pattern of patterns){\n\t\tconst hash = hasher.hash(pattern)\n\t\tlet arr = hashMap.get(hash)\n\t\tif(!arr){\n\t\t\tarr = []\n\t\t\thashMap.set(hash, arr)\n\t\t}\n\t\tarr.push(pattern)\n\t}\n\n\tconst freqMap = new Map<PatternData<T>, number>()\n\tfor(const patterns of hashMap.values()){\n\t\tfor(let i = 0; i < patterns.length; i++){\n\t\t\tconst pattern = patterns[i]\n\t\t\tif(!pattern){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tlet count = 0\n\t\t\tfor(let j = 0; j < patterns.length; j++){\n\t\t\t\tconst otherPattern = patterns[j]\n\t\t\t\tif(!otherPattern){\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tif(patternsAreEqual(pattern, otherPattern)){\n\t\t\t\t\tpatterns[j] = null\n\t\t\t\t}\n\t\t\t\tcount++\n\t\t\t}\n\t\t\tfreqMap.set(pattern, count)\n\t\t}\n\t}\n\tpatterns = [...freqMap.keys()]\n\n\tconst freqs: number[] = []\n\tfor(const pattern of patterns){\n\t\tfreqs.push(freqMap.get(pattern)!)\n\t}\n\treturn [patterns, normalizeArray(freqs)]\n}\n\nfunction patternsAreEqual<T>(a: PatternData<T>, b: PatternData<T>): boolean {\n\tfor(let x = 0; x < a.length; x++){\n\t\tconst aRow = a[x]!\n\t\tconst bRow = b[x]!\n\t\tfor(let y = 0; y < aRow.length; y++){\n\t\t\tif(aRow[y] !== bRow[y]){\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t}\n\treturn true\n}\n\n/** Class that is able to take fast (non-secure) hash from a pattern */\nclass PatternHasher<T> {\n\n\tprivate readonly valueIndices: Map<T, number> = new Map()\n\n\tconstructor(source: WaveFunctionCollapseInput<T>[\"sourceSample\"]) {\n\t\tconst allPossibleValues = [...new Set(flatten(source))]\n\t\tfor(let i = 0; i < allPossibleValues.length; i++){\n\t\t\tthis.valueIndices.set(allPossibleValues[i]!, i)\n\t\t}\n\t}\n\n\thash(pattern: PatternData<T>): number {\n\t\tlet hash = 0\n\n\t\tfor(let x = 0; x < pattern.length; x++){\n\t\t\tconst row = pattern[x]!\n\t\t\tfor(let y = 0; y < row.length; y++){\n\t\t\t\tconst item = row[y]!\n\t\t\t\tconst itemIndex = this.valueIndices.get(item)!\n\t\t\t\thash = ((hash << 5) - hash + (itemIndex * x * y)) | 0\n\t\t\t}\n\t\t}\n\n\t\treturn hash\n\t}\n}\n\nfunction flatten<T>(arr: readonly (readonly T[])[]): T[] {\n\tconst result: T[] = []\n\tfor(const row of arr){\n\t\tresult.push(...row)\n\t}\n\treturn result\n}\n\nfunction getPatternDataFromSource<T>(params: WaveFunctionCollapseInput<T>): PatternData<T>[] {\n\tlet patterns: PatternData<T>[] = []\n\tfor(let x = 0; x < params.sourceSample.length - params.patternSize + 1; x++){\n\t\tconst row = params.sourceSample[x]!\n\t\tfor(let y = 0; y < row.length - params.patternSize + 1; y++){\n\t\t\tpatterns.push(extractSourcePatternAt(params.sourceSample, x, y, params.patternSize))\n\t\t}\n\t}\n\n\tif(params.flip){\n\t\tconst flipped: PatternData<T>[] = []\n\t\tfor(const axis of [\"x\", \"y\"] as const){\n\t\t\tfor(const pattern of patterns){\n\t\t\t\tflipped.push(flipPattern(pattern, axis))\n\t\t\t}\n\t\t}\n\t\tpatterns = [...patterns, ...flipped]\n\t}\n\n\tif(params.rotate){\n\t\tconst rotated: PatternData<T>[] = []\n\t\tfor(const count of [1, 2, 3] as const){\n\t\t\tfor(const pattern of patterns){\n\t\t\t\trotated.push(rotatePattern(pattern, count))\n\t\t\t}\n\t\t}\n\t\tpatterns = [...patterns, ...rotated]\n\t}\n\n\treturn patterns\n}\n\nfunction extractSourcePatternAt<T>(source: WaveFunctionCollapseInput<T>[\"sourceSample\"], x: number, y: number, size: number): PatternData<T> {\n\tconst result: T[][] = []\n\tfor(let dx = 0; dx < size; dx++){\n\t\tconst row = source[x + dx]!\n\t\tresult.push(row.slice(y, y + size))\n\t}\n\treturn result\n}\n\nfunction copyPattern<T>(pattern: PatternData<T>): T[][] {\n\tconst result: T[][] = []\n\tfor(let x = 0; x < pattern.length; x++){\n\t\tresult.push([...pattern[x]!])\n\t}\n\treturn result\n}\n\nfunction flipPattern<T>(pattern: PatternData<T>, axis: \"x\" | \"y\"): PatternData<T> {\n\tconst res = copyPattern(pattern)\n\tconst halfLen = Math.floor(pattern.length / 2)\n\tif(axis === \"x\"){\n\t\tfor(let dx = 0; dx < halfLen; dx++){\n\t\t\tconst rowA = res[dx]!\n\t\t\tconst rowB = res[res.length - dx - 1]!\n\t\t\tfor(let y = 0; y < rowA.length; y++){\n\t\t\t\tconst tmp = rowA[y]!\n\t\t\t\trowA[y] = rowB[y]!\n\t\t\t\trowB[y] = tmp\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor(let x = 0; x < pattern.length; x++){\n\t\t\tconst row = res[x]!\n\t\t\tfor(let dy = 0; dy < halfLen; dy++){\n\t\t\t\tconst tmp = row[dy]!\n\t\t\t\trow[dy] = row[row.length - dy - 1]!\n\t\t\t\trow[row.length - dy - 1] = tmp\n\t\t\t}\n\t\t}\n\t}\n\treturn res\n}\n\nfunction rotatePattern<T>(pattern: PatternData<T>, times: 1 | 2 | 3): PatternData<T> {\n\tconst res = copyPattern(pattern)\n\tconst size = pattern.length\n\tconst halfSize = Math.floor(size / 2)\n\tfor(let i = 0; i < times; i++){\n\t\tfor(let circleOffset = 0; circleOffset < halfSize; circleOffset++){\n\t\t\tconst lastPos = size - circleOffset - 1\n\t\t\tfor(let posOffset = circleOffset; posOffset < size - circleOffset - 1; posOffset++){\n\t\t\t\tconst tmp = res[posOffset]![circleOffset]!\n\t\t\t\tres[posOffset]![circleOffset] = res[lastPos]![posOffset]!\n\t\t\t\tres[lastPos]![posOffset] = res[size - posOffset - 1]![lastPos]!\n\t\t\t\tres[size - posOffset - 1]![lastPos] = res[circleOffset]![size - posOffset - 1]!\n\t\t\t\tres[circleOffset]![size - posOffset - 1] = tmp\n\t\t\t}\n\t\t}\n\t}\n\treturn res\n}\n\nclass Matrix {\n\tprivate readonly entropy: number[]\n\tprivate readonly matrix: Bitmap\n\tprivate readonly collapseMask: Bitmap\n\tprivate readonly patternCount: number\n\tprivate incollapsedCellsCount: number\n\n\tconstructor(\n\t\tprivate readonly width: number,\n\t\tprivate readonly height: number,\n\t\tpatternCount: number,\n\t\tprivate readonly random: () => number,\n\t\tprivate readonly rules: Rules,\n\t\tprivate readonly offsets: XY[],\n\t\tprivate readonly freqs: number[]\n\t) {\n\t\tthis.patternCount = Math.ceil(patternCount / 8) * 8\n\t\tthis.entropy = new Array(width * height).fill(1)\n\t\tthis.matrix = new Bitmap(width * height * this.patternCount)\n\t\tthis.collapseMask = new Bitmap(width * height)\n\t\tthis.incollapsedCellsCount = width * height\n\n\t\tthis.matrix.setAll()\n\t\tconst paddingPatternCount = this.patternCount - patternCount\n\t\tfor(let i = 0; i < width * height; i++){\n\t\t\tconst cellEnd = ((i + 1) * this.patternCount) - 1\n\t\t\tfor(let offset = 0; offset < paddingPatternCount; offset++){\n\t\t\t\tthis.matrix.clear(cellEnd - offset)\n\t\t\t}\n\t\t}\n\t}\n\n\tisEverythingCollapsed(): boolean {\n\t\treturn this.incollapsedCellsCount === 0\n\t}\n\n\tfindMinEntropyCell(): XY | null {\n\t\tlet minEntropy = Number.MAX_SAFE_INTEGER\n\t\tconst cells: number[] = []\n\t\tfor(let i = 0; i < this.entropy.length; i++){\n\t\t\tif(this.collapseMask.get(i)){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tconst entropy = this.entropy[i]!\n\t\t\tif(entropy < minEntropy){\n\t\t\t\tcells.length = 0\n\t\t\t\tminEntropy = entropy\n\t\t\t}\n\t\t\tif(entropy === minEntropy){\n\t\t\t\tcells.push(i)\n\t\t\t}\n\t\t}\n\t\tif(cells.length === 0){\n\t\t\treturn null\n\t\t}\n\n\t\t// console.log(`Lowest entropy cells are at ${minEntropy}: `, cells.map(index => ({x: index % this.width, y: Math.floor(index / this.width)})))\n\n\t\tconst index = cells.length === 1 ? cells[0]! : cells[Math.floor(this.random() * cells.length)]!\n\t\treturn {x: index % this.width, y: Math.floor(index / this.width)}\n\t}\n\n\tcollapse(cell: XY): void {\n\t\tperformeter.enterBlock(\"collapse-set\")\n\t\t// console.log(`Collapsing at (${cell.x}, ${cell.y}): \\n${this}`)\n\t\tconst cellIndex = cell.y * this.width + cell.x\n\t\tconst availableValues = this.matrix.getOffsetsAsNumbers(cellIndex * this.patternCount, this.patternCount)\n\t\tif(availableValues.length === 0){\n\t\t\t// should be caught on propagate stage tbh\n\t\t\tthrow new Error(`Cell at (${cell.x}, ${cell.y}) don't have available values`)\n\t\t}\n\t\tthis.collapseMask.set(cellIndex)\n\t\tthis.incollapsedCellsCount--\n\t\tif(availableValues.length === 1){\n\t\t\tperformeter.exitBlock()\n\t\t\treturn // it's already kinda collapsed, no action required\n\t\t}\n\t\tconst selectedValue = availableValues[Math.floor(this.random() * availableValues.length)]!\n\t\t// console.log(\"Selected value: \" + selectedValue)\n\t\t// console.log(ruleToString(this.rules[selectedValue]!))\n\t\tfor(const value of availableValues){\n\t\t\tif(value === selectedValue){\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tthis.matrix.clear(cellIndex * this.patternCount + value)\n\t\t}\n\t\tthis.entropy[cellIndex] = 0\n\t\tperformeter.exitEnterBlock(\"propagate\")\n\t\tthis.propagateStartingAt(cell)\n\t\tperformeter.exitBlock()\n\t}\n\n\tprivate isInBounds(coords: XY): boolean {\n\t\treturn coords.x >= 0 && coords.y >= 0 && coords.x < this.width && coords.y < this.height\n\t}\n\n\tprivate propagateStartingAt(cell: XY): void {\n\t\tconst queue = new SetQueue<number>()\n\t\tqueue.enqueue(encodePosition(cell))\n\n\t\twhile(true){\n\t\t\tconst origCellEncoded = queue.dequeue()\n\t\t\tif(origCellEncoded === undefined || origCellEncoded === null){\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tconst origCell = decodePosition(origCellEncoded)\n\t\t\t// console.log(`Propagating at (${origCell.x}, ${origCell.y})`)\n\n\t\t\tfor(const offset of this.offsets){\n\t\t\t\tconst adjacentCellPos = {x: origCell.x + offset.x, y: origCell.y + offset.y}\n\t\t\t\tif(!this.isInBounds(adjacentCellPos)){\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst adjacentCellIndex = adjacentCellPos.y * this.width + adjacentCellPos.x\n\t\t\t\tif(this.collapseMask.get(adjacentCellIndex)){\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\tconst changed = this.propagateToCellByOffset(origCell, offset)\n\t\t\t\tif(changed){\n\t\t\t\t\tqueue.enqueue(encodePosition(adjacentCellPos))\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate propagateToCellByOffset(origCell: XY, offset: XY): boolean {\n\t\t// TODO: optimise here\n\t\tperformeter.enterBlock(\"assemble_pattern\")\n\t\tconst encodedOffset = encodeOffset(offset)\n\t\tconst origCellIndex = origCell.y * this.width + origCell.x\n\t\tperformeter.enterBlock(\"get offsets\")\n\t\tconst origCellPatterns = this.matrix.getOffsetsAsNumbers(origCellIndex * this.patternCount, this.patternCount)\n\t\tperformeter.exitEnterBlock(\"OR pattern\")\n\t\tconst resultTargetCellPatterns = new Bitmap(this.patternCount)\n\t\tfor(const origPattern of origCellPatterns){\n\t\t\tconst patternsByRule = this.rules[origPattern]!.get(encodedOffset)!\n\t\t\tresultTargetCellPatterns.orFromTheStart(patternsByRule)\n\t\t}\n\t\tperformeter.exitBlock()\n\n\t\tperformeter.exitEnterBlock(\"apply_pattern\")\n\t\tconst targetCell = {x: origCell.x + offset.x, y: origCell.y + offset.y}\n\t\tconst targetCellIndex = targetCell.y * this.width + targetCell.x\n\t\tconst hasChange = this.matrix.and(resultTargetCellPatterns, targetCellIndex * this.patternCount)\n\t\tif(hasChange){\n\t\t\tthis.entropy[targetCellIndex] = this.matrix.getOffsetsAsNumbers(targetCellIndex * this.patternCount, this.patternCount)\n\t\t\t\t.map(pattern => this.freqs[pattern]!)\n\t\t\t\t.reduce((a, b) => a + b, 0)\n\t\t}\n\t\tperformeter.exitBlock()\n\t\treturn hasChange\n\t}\n\n\tgetResults(): number[][] {\n\t\tconst result: number[][] = []\n\t\tfor(let x = 0; x < this.width; x++){\n\t\t\tconst row: number[] = []\n\t\t\tresult.push(row)\n\t\t\tfor(let y = 0; y < this.height; y++){\n\t\t\t\tconst index = y * this.width + x\n\t\t\t\tconst patterns = this.matrix.getOffsetsAsNumbers(index * this.patternCount, this.patternCount)\n\t\t\t\trow.push(patterns[0]!)\n\t\t\t}\n\t\t}\n\t\treturn result\n\t}\n\n\ttoString(): string {\n\t\tlet longestCellLen = 0\n\t\tconst result: string[][] = []\n\t\tfor(let y = 0; y < this.height; y++){\n\t\t\tconst row: string[] = []\n\t\t\tresult.push(row)\n\t\t\tfor(let x = 0; x < this.width; x++){\n\t\t\t\tconst index = y * this.width + x\n\t\t\t\tconst patterns = this.matrix.getOffsetsAsNumbers(index * this.patternCount, this.patternCount)\n\t\t\t\tconst str = shortenNumberSpan(patterns)\n\t\t\t\trow.push(str)\n\t\t\t\tlongestCellLen = Math.max(longestCellLen, str.length)\n\t\t\t}\n\t\t}\n\t\treturn result.map(row => row.map(cell => whitePad(cell, longestCellLen)).join(\" | \")).join(\"\\n\")\n\t}\n\n}\n\nfunction whitePad(str: string, len: number): string {\n\twhile(str.length < len){\n\t\tstr += \" \"\n\t}\n\treturn str\n}\n\nfunction makeRandom(seed: number): () => number {\n\tseed ^= 0xDEADBEEF\n\t// Pad seed with Phi, Pi and E.\n\t// https://en.wikipedia.org/wiki/Nothing-up-my-sleeve_number\n\tconst rand = sfc32(0x9E3779B9, 0x243F6A88, 0xB7E15162, seed)\n\tfor(let i = 0; i < 15; i++){\n\t\trand()\n\t}\n\treturn rand\n}\n\nfunction sfc32(a: number, b: number, c: number, d: number) {\n\treturn function() {\n\t\ta >>>= 0; b >>>= 0; c >>>= 0; d >>>= 0\n\t\tlet t = (a + b) | 0\n\t\ta = b ^ b >>> 9\n\t\tb = c + (c << 3) | 0\n\t\tc = (c << 21 | c >>> 11)\n\t\td = d + 1 | 0\n\t\tt = t + d | 0\n\t\tc = c + t | 0\n\t\treturn (t >>> 0) / 4294967296\n\t}\n}\n\nclass SetQueue<T> {\n\tprivate readonly set = new Set<T>()\n\tprivate readonly queue: (T | null)[] = []\n\tprivate pos = 0\n\n\tenqueue(value: T): boolean {\n\t\tif(this.set.has(value)){\n\t\t\treturn false\n\t\t}\n\t\tthis.set.add(value)\n\t\tthis.queue.push(value)\n\t\treturn true\n\t}\n\n\tdequeue(): T | null | undefined {\n\t\tconst result = this.queue[this.pos]\n\t\tthis.queue[this.pos] = null\n\t\tif(this.queue.length > this.pos){\n\t\t\tthis.set.delete(result!)\n\t\t\tthis.pos++\n\t\t}\n\t\treturn result\n\t}\n}\n\n/** Format sequence of numbers in a shorter manner, compressing sequental spans into from-to format */\nfunction shortenNumberSpan(nums: number[]): string {\n\treturn joinSpans(nums, (a, b) => a + 1 === b).map(span => {\n\t\tconst first = span[0]!\n\t\tconst last = span[span.length - 1]!\n\t\tif(first === last){\n\t\t\treturn first + \"\"\n\t\t} else if(first + 1 === last){\n\t\t\treturn first + \",\" + last\n\t\t} else {\n\t\t\treturn first + \"-\" + last\n\t\t}\n\t}).join(\",\")\n}\n\nfunction joinSpans<T>(values: T[], shouldJoin: (a: T, b: T) => boolean): T[][] {\n\tconst result: T[][] = []\n\tif(values.length === 0){\n\t\treturn result\n\t}\n\tlet currentSpan: T[] = [values[0]!]\n\tresult.push(currentSpan)\n\n\tfor(let i = 1; i < values.length; i++){\n\t\tconst v = values[i]!\n\t\tif(shouldJoin(currentSpan[currentSpan.length - 1]!, v)){\n\t\t\tcurrentSpan.push(v)\n\t\t} else {\n\t\t\tcurrentSpan = [v]\n\t\t\tresult.push(currentSpan)\n\t\t}\n\t}\n\n\treturn result\n}","/** An optimized array of bits (booleans) */\nexport class Bitmap {\n\tprivate readonly arr: Uint8Array\n\tconstructor(readonly size: number) {\n\t\tif(size < 0){\n\t\t\tthrow new Error(`Expected non-negative as size, got ${size}`)\n\t\t}\n\n\t\tif(size % 8){\n\t\t\tsize = Math.ceil(size / 8) * 8\n\t\t}\n\n\t\tthis.arr = new Uint8Array(size >> 3)\n\t}\n\n\t/** Set bit at selected index to 1 */\n\tset(index: number): void {\n\t\tconst arr = this.arr\n\t\tconst byteIndex = index >> 3\n\t\tarr[byteIndex] = arr[byteIndex]! | (1 << (index & 0b111))\n\t}\n\n\t/** Set bit at selected index to 0 */\n\tclear(index: number): void {\n\t\tconst arr = this.arr\n\t\tconst byteIndex = index >> 3\n\t\tarr[byteIndex] = arr[byteIndex]! & (~(1 << (index & 0b111)))\n\t}\n\n\t/** Get value of bit at index */\n\tget(index: number): boolean {\n\t\treturn (this.arr[index >> 3]! & (1 << (index & 0b111))) !== 0\n\t}\n\n\t/** Set value of all the bits to 1 */\n\tsetAll(): void {\n\t\tthis.arr.fill(0xff)\n\t}\n\n\t/** Set value of all the bits to 0 */\n\tclearAll(): void {\n\t\tthis.arr.fill(0)\n\t}\n\n\t/** @returns sorted array of offsets within [start, start + length] */\n\tgetOffsetsAsNumbers(start: number, length: number): number[] {\n\t\tif(start & 0x7 || length & 0x7){\n\t\t\tthrow new Error(\"Assertion failed, only byte-aligned start/length is supported\")\n\t\t}\n\t\tconst result: number[] = []\n\t\tlet i = 0\n\t\tfor(let byteOffset = 0; byteOffset < (length >> 3); byteOffset++){\n\t\t\tconst byte = this.arr[(start >> 3) + byteOffset]!\n\t\t\tlet mask = 0x1\n\t\t\twhile(mask !== 0x100){\n\t\t\t\tif(byte & mask){\n\t\t\t\t\tresult.push(i)\n\t\t\t\t}\n\t\t\t\ti++\n\t\t\t\tmask <<= 1\n\t\t\t}\n\t\t}\n\t\treturn result\n\t}\n\n\t/** Sets to 1 every offset that is present in array of offsets and to 0 everything else\n\t * @param offsets sorted array of offsets\n\t * @returns if anything was changed */\n\tsetOffsetsByNumbers(start: number, length: number, offsets: number[]): boolean {\n\t\tif(start & 0x7 || length & 0x7){\n\t\t\tthrow new Error(\"Assertion failed, only byte-aligned start/length is supported\")\n\t\t}\n\t\tlet hasChange = false\n\t\tlet offset = 0\n\t\tlet offsetIndex = 0\n\t\tlet nextNonzeroOffset = offsets[offsetIndex]\n\t\tfor(let byteOffset = 0; byteOffset < (length >> 3); byteOffset++){\n\t\t\tconst origByte = this.arr[(start >> 3) + byteOffset]!\n\t\t\tlet byte = 0\n\t\t\tlet mask = 0x1\n\t\t\twhile(mask !== 0x100){\n\t\t\t\tconst bit = offset === nextNonzeroOffset ? mask : 0\n\t\t\t\thasChange = hasChange || (origByte & mask) !== bit\n\t\t\t\tif(bit){\n\t\t\t\t\tbyte |= mask\n\t\t\t\t\toffsetIndex++\n\t\t\t\t\tnextNonzeroOffset = offsets[offsetIndex]\n\t\t\t\t}\n\t\t\t\toffset++\n\t\t\t\tmask <<= 1\n\t\t\t}\n\t\t\tthis.arr[(start >> 3) + byteOffset] = byte\n\t\t}\n\t\treturn hasChange\n\t}\n\n\t/** Applies bitwise-and operation to this bitmap; saves result in this bitmap\n\t * Expecting other bitmap to be smaller than this one\n\t * @returns if this bitmap was changed\n\t */\n\tand(other: Bitmap, startThis: number): boolean {\n\t\tif(startThis & 0x7){\n\t\t\tthrow new Error(\"Assertion failed, only byte-aligned start/length is supported\")\n\t\t}\n\t\tlet hasChange = false\n\t\tfor(let byteOffset = 0; byteOffset < other.arr.length; byteOffset++){\n\t\t\tconst thisByte = this.arr[(startThis >> 3) + byteOffset]!\n\t\t\tconst otherByte = other.arr[byteOffset]!\n\t\t\tconst result = thisByte & otherByte\n\t\t\thasChange = hasChange || (result !== thisByte)\n\t\t\tthis.arr[(startThis >> 3) + byteOffset] = result\n\t\t}\n\t\treturn hasChange\n\t}\n\n\torFromTheStart(other: Bitmap): void {\n\t\tif(other.arr.length > this.arr.length){\n\t\t\tthrow new Error(\"Assertion failed, lengths are not equal\")\n\t\t}\n\t\tfor(let byteOffset = 0; byteOffset < other.arr.length; byteOffset++){\n\t\t\tthis.arr[byteOffset] = this.arr[byteOffset]! | other.arr[byteOffset]!\n\t\t}\n\t}\n\n}","[[16754689,16754689,16754689,16754689,16754689,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776],[26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776],[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776],[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,16754689],[26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,16754689,16754689,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16754689],[26776,16754689,16754689,16771843,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,16754689,16754689,16771843,16771843],[16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,16754689,16754689,16771843,16771843,16771843],[16754689,16771843,16771843,14817887,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,16754689,16771843,16771843,14817887,16771843],[16754689,16754689,16771843,16771843,16771843,14817887,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843],[26776,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887],[26776,26776,16754689,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843],[26776,26776,26776,26776,16754689,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689],[26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689],[16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776],[16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,26776,26776,26776],[14817887,16771843,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776],[16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776],[16771843,14817887,16771843,16771843,16771843,16754689,16754689,26776,26776,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776],[16771843,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776],[14817887,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776],[16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689],[16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689],[16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,14817887,16771843,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843],[16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,14817887,16771843],[16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843],[16771843,16754689,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843],[16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689],[16754689,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,16754689],[26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776],[26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776],[26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776],[26776,26776,16754689,16754689,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,16754689,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776],[26776,16754689,16754689,16771843,14817887,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,16754689],[26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689],[26776,26776,16754689,16754689,16771843,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843],[26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843],[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843],[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843],[16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843],[16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16754689,16754689,16754689,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689],[16771843,16754689,26776,26776,26776,26776,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16771843,16771843,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16754689,16754689],[16754689,16754689,26776,26776,26776,16754689,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,16754689,16754689,26776],[16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776],[26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776],[26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,14817887,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,16754689],[16754689,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,16754689,16754689,16754689],[16754689,16754689,26776,26776,26776,26776,16754689,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16771843,16771843,14817887,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843],[16754689,16754689,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843],[16754689,26776,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16771843,16771843,16754689,16754689,26776,26776,26776,16754689,16771843,16771843,14817887,16771843],[16754689,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776,26776,26776,16754689,16754689,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,26776,16754689,16754689,16754689,16771843,16771843,16771843,16771843,14817887,16771843,16771843,16754689,26776,26776,26776,16754689,16754689,16771843,16771843,16771843,16771843]]","[[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776],[26776,26776,26776,16754689,16754689,26776,26776,26776,26776,26776],[26776,26776,16754689,16771843,16771843,16754689,16754689,16754689,26776,26776],[26776,26776,16754689,16771843,16771843,16771843,16771843,16771843,16754689,26776],[26776,26776,26776,16754689,16771843,5487617,16771843,16771843,16754689,26776],[26776,26776,26776,16754689,16771843,16771843,16771843,16771843,16754689,26776],[26776,26776,26776,16754689,16771843,16771843,16771843,16771843,16754689,26776],[26776,26776,26776,26776,16754689,16754689,16754689,16754689,26776,26776],[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776],[26776,26776,26776,26776,26776,26776,26776,26776,26776,26776]]"],"names":["$8HcCf","parcelRequire","$02ba7994cbb01639$export$f22da7240b7add18","root","patternInput","$ffFvw","PatternInput","palette","defaultValue","height","width","scale","display","$jVGbq","ColorArrayDisplay","appendChild","$aCP3q","tag","class","$9sNwz","tagName","text","on","click","source","getPattern","console","log","JSON","stringify","result","$1OdCr","waveFunctionCollapse","flip","rotate","sourceSample","patternSize","randomSeed","resultSize","draw","performeter","print","reset","setValue","$f9tgb","$6f792b9b35387246$export$e1ee22bc4cc102ea","this","makeBlock","currentBlock","eventCounters","parent","subblocks","timeStart","timeSum","enterCount","enterBlock","name","nextBlock","performance","now","recordEvent","exitBlock","Error","exitEnterBlock","table","fullTime","forEachBlock","block","depth","Array","join","$6f792b9b35387246$var$strip","callback","start","currentDepth","subblock","v","Math","round","$hIDiW","$4c0fbf616468c6ce$var$resolveArgs","a","b","isArray","$hsvBG","isRBox","$4c0fbf616468c6ce$var$populateTag","tagBase","description","children","binder","getBinder","watch","textContent","unbox","evtName","handler","addEventListener","passive","capture","k","attrs","removeAttribute","setAttribute","vv","setChildren","childTags","filter","x","newChildren","i","length","childTag","childNodes","insertBefore","remove","$4c0fbf616468c6ce$var$updateChildren","$jM5hi","makeClassname","classname","classList","value","$4c0fbf616468c6ce$export$2b067c6666111485","document","createElement","style","$4c0fbf616468c6ce$export$e0e99c6b21dfde8d","createElementNS","setAttributeNS","$0d27fb504028ccb8$export$4ded07f8b6ee4cea","node","parts","arr","item","makeClassnameAndCallTheCallback","key","bool","push","classname1","$efatB","$96d2a9ef9a2c2245$export$5640fc17115cf007","constructor","canvas","context","getContext","values","w","h","s","row","y","fillStyle","rgbNumberToColorString","fillRect","$fa4a5aa5cdd6ce8e$var$twoHex","toString","$fa4a5aa5cdd6ce8e$export$fdc9c29511f1a926","color","$fa4a5aa5cdd6ce8e$export$79db3ad3d560d193","components","r","g","$fa4a5aa5cdd6ce8e$var$hueToRgb","p","q","t","$fa4a5aa5cdd6ce8e$export$c5ea230d2f55d434","rgb","$fa4a5aa5cdd6ce8e$export$21d90289cdbe307c","colorRgb","transform","transformResult","cmin","min","cmax","max","delta","l","abs","toFixed","$fa4a5aa5cdd6ce8e$export$c85ca4f4753af384","hsl","floor","$fa4a5aa5cdd6ce8e$export$29fb7152bd3f781a","$013bb80b3ccfc188$export$c5328dac6d89974f","params","primaryCb","$ih12A","preventContextMenu","addCursorMoveHandler","element","onMove","onSetColorAction","bind","downIsMove","pattern","fill","map","paletteButtons","button","selectColor","backgroundColor","redrawCanvas","e","coords","pointerEventsToOffsetCoords","cellX","cellY","cb","set","parse","prevCb","dfltClassName","clsName","className","add","$070b40bf88f7afea$export$f9e1fc62131d1b82","touches","$070b40bf88f7afea$export$c4dfce035d43d1e0","touch","clientX","clientY","$070b40bf88f7afea$export$4eb1c1f17f883a41","target","HTMLElement","rect","getBoundingClientRect","left","top","$070b40bf88f7afea$export$80eb02ad18c977f1","onDown","window","onUp","removeEventListener","upIsMove","$070b40bf88f7afea$export$b3002a74c1b9a5fd","el","preventDefault","stopPropagation","$6e3d250e7771e99d$export$be5cd583167290d2","$6e3d250e7771e99d$export$9a9aa9ffab568c99","$6e3d250e7771e99d$export$f9ca6c3b4d310360","$6e3d250e7771e99d$export$b64206a3d550df71","$6e3d250e7771e99d$export$6cc254038363eb2f","$1VHh9","$b29a1f8e2035086d$export$afb809ac55339913","patterns","matrix","offsets","$b29a1f8e2035086d$var$generateOffsets","patternsFreq","$b29a1f8e2035086d$var$extractSourcePatternAt","flipped","axis","$b29a1f8e2035086d$var$flipPattern","rotated","count","pattern1","$b29a1f8e2035086d$var$rotatePattern","$b29a1f8e2035086d$var$getPatternDataFromSource","hashMap","Map","hasher","$b29a1f8e2035086d$var$PatternHasher","hash","get","freqMap","patterns1","j","otherPattern","$b29a1f8e2035086d$var$patternsAreEqual","keys","freqs","pattern2","$b29a1f8e2035086d$var$normalizeArray","$b29a1f8e2035086d$var$generatePatternsAndFrequences","rules","offset","$b29a1f8e2035086d$var$encodeOffset","Bitmap","encodedOffset","flipEncodedOffset","$b29a1f8e2035086d$var$flipOffset","aIndex","bIndex","$b29a1f8e2035086d$var$patternsHaveMatch","$b29a1f8e2035086d$var$getRules","random","seed","rand","c","d","$b29a1f8e2035086d$var$makeRandom","$b29a1f8e2035086d$var$Matrix","$b29a1f8e2035086d$var$init","isEverythingCollapsed","lowestEntropyPoint","findMinEntropyCell","collapse","patternIndices","getResults","patternIndex","intersectionLengthX","intersectionLengthY","startXA","startYA","startXB","startYB","dx","dy","$b29a1f8e2035086d$var$encodePosition","position","input","sum","reduce","aRow","bRow","valueIndices","allPossibleValues","Set","$b29a1f8e2035086d$var$flatten","size","slice","$b29a1f8e2035086d$var$copyPattern","res","halfLen","rowA","rowB","tmp","tmp1","times","halfSize","circleOffset","lastPos","posOffset","patternCount","ceil","entropy","collapseMask","incollapsedCellsCount","setAll","paddingPatternCount","cellEnd","clear","minEntropy","Number","MAX_SAFE_INTEGER","cells","index","cell","cellIndex","availableValues","getOffsetsAsNumbers","selectedValue","propagateStartingAt","isInBounds","queue","$b29a1f8e2035086d$var$SetQueue","enqueue","origCellEncoded","dequeue","origCell","adjacentCellPos","adjacentCellIndex","propagateToCellByOffset","origCellIndex","origCellPatterns","resultTargetCellPatterns","origPattern","patternsByRule","orFromTheStart","targetCell","targetCellIndex","hasChange","and","longestCellLen","str","shouldJoin","currentSpan","$b29a1f8e2035086d$var$joinSpans","span","first","last","len","$b29a1f8e2035086d$var$whitePad","pos","has","delete","$665dc4e67c6f8c6a$export$3924f7882b5e2b61","Uint8Array","byteIndex","clearAll","byteOffset","byte","mask","setOffsetsByNumbers","offsetIndex","nextNonzeroOffset","origByte","bit","other","startThis","thisByte","module","exports"],"version":3,"file":"wave_function_collapse.774ca59f.js.map"}