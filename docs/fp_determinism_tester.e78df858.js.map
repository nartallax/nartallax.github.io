{"mappings":"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","sources":["src/sketches/fp_determinism_tester/fp_determinism_tester.ts","node_modules/@parcel/runtime-js/lib/runtime-a3f5e19a4906ecf3.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","src/sketches/fp_determinism_tester/fp_determinism_tester.module.scss","src/sketches/fp_determinism_tester/catmull-rom.ts","src/sketches/fp_determinism_tester/perlin_noise.ts","src/common/seeded_random.ts","src/sketches/fp_determinism_tester/trigonometry.ts"],"sourcesContent":["import {svgTag, tag} from \"@nartallax/cardboard-dom\"\nimport inputDataPath from \"./input_data.txt\"\nimport * as css from \"./fp_determinism_tester.module.scss\"\nimport {getCatmullRomSvgPathForDotSequence} from \"sketches/fp_determinism_tester/catmull-rom\"\nimport {PerlinNoiseGenerator} from \"sketches/fp_determinism_tester/perlin_noise\"\nimport {cos, sin} from \"sketches/fp_determinism_tester/trigonometry\"\n\nconst runTheTests = (testData: any): FullTestRunResult[] => {\n\tconst {numbers: [o1, o2, o3, o4, negZero], catmullRom} = testData\n\treturn runTests([\n\t\t[\"0.1 + 0.2\", x => x + o1 + o2],\n\t\t[\"0.1 - 0.2\", x => x + o1 - o2],\n\t\t[\"0.1 * 0.2\", x => x + o1 * o2],\n\t\t[\"0.1 / 0.2\", x => x + o1 / o2],\n\t\t[\"(0.1 * 0.2) + (0.3 * 0.4)\", x => x + (o1 * o2) + (o3 * o4)],\n\t\t[\"M.sin(0.1) + M.cos(0.2)\", x => x + Math.sin(o1) + Math.cos(o2)],\n\t\t[\"sin(0.1) + cos(0.2)\", x => x + sin(o1) + cos(o2)],\n\t\t[\"sqrt(0.3) + sqrt(0.4)\", x => x + Math.sqrt(o3) + Math.sqrt(o4)],\n\t\t[\"-0 + -0\", () => negZero + negZero],\n\t\t[\"-0 + 0.1 - 0.1\", x => x + negZero + o1 - o1],\n\t\t[\"Catmull-Rom curves\", x => x + getCatmullRomSvgPathForDotSequence(catmullRom)\n\t\t\t.map(x => typeof(x) === \"string\" ? 1 : x)\n\t\t\t.reduce((a, b) => a * b, 1)],\n\t\t[\"Perlin noise\", x => x + calcPerlinNoiseChecksum(testData)]\n\t])\n}\n\nconst waitForFrame = () => new Promise(ok => requestAnimationFrame(ok))\n\nexport async function main(root: HTMLElement): Promise<void> {\n\tconst btn = tag({\n\t\ttag: \"button\",\n\t\tclass: css.button,\n\t\tonClick: async() => {\n\t\t\tbtn.textContent = \"Running...\"\n\t\t\tbtn.setAttribute(\"disabled\", \"disabled\")\n\t\t\tawait waitForFrame()\n\t\t\tawait waitForFrame()\n\t\t\ttry {\n\t\t\t\tconst testResults = runTheTests(data)\n\t\t\t\tconst table = makeResultsTable(testResults)\n\t\t\t\tbtn.replaceWith(table)\n\t\t\t\troot.prepend(makeCopyButton(testResults))\n\n\t\t\t\troot.prepend(renderVisualStuff(data))\n\t\t\t} catch(e){\n\t\t\t\tconsole.error(e)\n\t\t\t\tbtn.textContent = \"Something failed! Whoopsie. See console output.\"\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}, [\"Loading...\"])\n\n\troot.appendChild(btn)\n\n\t// storing this behind network request to avoid static code optimization\n\tconst data = await(await fetch(inputDataPath)).json()\n\tbtn.textContent = \"Run the tests!\"\n\t// root.prepend(renderVisualStuff(data))\n}\n\ntype Test = [\n\tname: string,\n\trunner: (prevResult: number) => number\n]\n\ntype ShortTestRunResult = {\n\tname: string\n\tdec: string\n\tbin: string\n}\n\ntype FullTestRunResult = ShortTestRunResult & {\n\ttime: number\n}\n\ntype TestTiming = {time: number, runCount: number}\n\nconst makeCopyButton = (testResults: FullTestRunResult[]) => tag({\n\ttag: \"button\",\n\tclass: css.buttonSmall,\n\tonClick: () => {\n\t\tconst arrs = testResults.map(({\n\t\t\tname, bin\n\t\t}) => [name, bin])\n\t\tvoid navigator.clipboard.writeText(JSON.stringify(arrs)\n\t\t\t.replaceAll(/\\],\\[/g, \"],\\n[\")\n\t\t\t.replaceAll(/\\[\\[/g, \"[\\n[\")\n\t\t\t.replaceAll(/\\]\\]/g, \"]\\n]\")\n\t\t)\n\t}\n}, [\"Copy all of this\"])\n\nconst makeResultsTable = (data: FullTestRunResult[]): HTMLElement => {\n\treturn tag({tag: \"table\", class: css.table}, [\n\t\ttag({tag: \"tr\"}, [\n\t\t\ttag({tag: \"th\"}, [\"Name\"]),\n\t\t\ttag({tag: \"th\"}, [\"Decimal\"]),\n\t\t\ttag({tag: \"th\"}, [\"Binary\"]),\n\t\t\ttag({tag: \"th\"}, [\"Time (ms)\"])\n\t\t]),\n\t\t...data.map(({\n\t\t\tname, dec, bin, time\n\t\t}) => tag({tag: \"tr\"}, [\n\t\t\ttag({tag: \"td\"}, [name]),\n\t\t\ttag({tag: \"td\"}, [dec]),\n\t\t\ttag({tag: \"td\"}, [bin]),\n\t\t\ttag({tag: \"td\"}, [time.toFixed(10)])\n\t\t]))\n\t])\n}\n\nconst runTests = (tests: Test[]): FullTestRunResult[] => {\n\tconst coldTimings = makeTimings(tests)\n\tconst coldResults = runRoundOfTests(tests, coldTimings)\n\n\tconst throwawayTimings = makeTimings(tests)\n\tconst now = Date.now()\n\twhile(Date.now() - now < 5000){\n\t\trunRoundOfTests(tests, throwawayTimings)\n\t}\n\n\tconst hotTimings = makeTimings(tests)\n\tconst hotResults = runRoundOfTests(tests, hotTimings)\n\n\tconst enrichedCold = enrichWithTiming(coldResults, coldTimings, \"(c) \")\n\tconst enrichedHot = enrichWithTiming(hotResults, hotTimings, \"(h) \")\n\n\treturn insertAtEachNth(enrichedHot, enrichedCold, 2)\n\n}\n\nconst makeTimings = (tests: Test[]): TestTiming[] => tests.map(() => ({runCount: 0, time: 0}))\nconst enrichWithTiming = (results: ShortTestRunResult[], timings: TestTiming[], suffix?: string): FullTestRunResult[] => {\n\treturn results.map((res, index) => {\n\t\tconst timing = timings[index]!\n\t\treturn ({\n\t\t\t...res,\n\t\t\tname: !suffix ? res.name : suffix + res.name,\n\t\t\ttime: timing.time / timing.runCount\n\t\t})\n\t})\n}\n\nconst insertAtEachNth = <T>(receivingArray: T[], sourceArray: T[], n: number): T[] => {\n\tlet srcIndex = 0\n\tlet recIndex = 0\n\tconst result: T[] = new Array(receivingArray.length + sourceArray.length)\n\tfor(let i = 0; i < result.length; i++){\n\t\tresult[i] = (i % n) === 0 ? sourceArray[srcIndex++]! : receivingArray[recIndex++]!\n\t}\n\treturn result\n}\n\nconst runRoundOfTests = (tests: Test[], timing: TestTiming[]): ShortTestRunResult[] => {\n\tconst result: ShortTestRunResult[] = []\n\tconst dblBuffer = new DataView(new ArrayBuffer(8))\n\tfor(let i = 0; i < tests.length; i++){\n\t\tconst test = tests[i]!\n\t\tconst testTiming = timing[i]!\n\t\tconst startTime = performance.now()\n\t\tlet testResult = 0\n\t\tfor(let i = 0; i < 1000; i++){\n\t\t\ttestResult = test[1](testResult)\n\t\t}\n\t\ttestTiming.time += performance.now() - startTime\n\t\ttestTiming.runCount++\n\t\tconst testResultDec = testResult.toFixed(20)\n\t\tdblBuffer.setFloat64(0, testResult)\n\t\tlet testResultBin = \"\"\n\t\tfor(let i = 0; i < 8; i++){\n\t\t\tlet byteStr = dblBuffer.getUint8(i).toString(2)\n\t\t\twhile(byteStr.length < 8){\n\t\t\t\tbyteStr = \"0\" + byteStr\n\t\t\t}\n\t\t\ttestResultBin += byteStr\n\t\t}\n\t\tresult.push({name: test[0], dec: testResultDec, bin: testResultBin})\n\t}\n\treturn result\n}\n\nconst renderVisualStuff = (data: any): HTMLElement => {\n\tconst catmullRomPath = getCatmullRomSvgPathForDotSequence(data.catmullRom).join(\" \")\n\treturn tag({class: css.stuffDisplay}, [\n\t\trenderSvgPath(catmullRomPath),\n\t\trenderPerlinGrid(data)\n\t])\n}\n\nconst perlinOffset = -5\nconst perlinSize = 10\nconst perlinResolution = 5\n\nconst renderPerlinGrid = (data: any): HTMLElement => {\n\tconst pixelSize = 20\n\tconst canvas = tag({tag: \"canvas\", attrs: {width: perlinSize * pixelSize, height: perlinSize * pixelSize}})\n\tconst ctx = canvas.getContext(\"2d\")!\n\tconst gen = new PerlinNoiseGenerator(data.perlinSeed, data.pi)\n\tfor(let x = perlinOffset; x < perlinOffset + perlinSize; x++){\n\t\tfor(let y = perlinOffset; y < perlinOffset + perlinSize; y++){\n\t\t\tconst noise = Math.floor((gen.get((x + 0.5) / perlinResolution, (y + 0.5) / perlinResolution) + 1) * 128)\n\t\t\tlet noiseColor = noise.toString(16)\n\t\t\tif(noiseColor.length < 2){\n\t\t\t\tnoiseColor = \"0\" + noiseColor\n\t\t\t}\n\t\t\tnoiseColor = `#${noiseColor}${noiseColor}${noiseColor}`\n\t\t\tctx.fillStyle = noiseColor\n\t\t\tctx.fillRect((x - perlinOffset) * pixelSize, (y - perlinOffset) * pixelSize, pixelSize, pixelSize)\n\t\t}\n\t}\n\treturn canvas\n}\n\nconst calcPerlinNoiseChecksum = (data: any): number => {\n\tlet sum = 0\n\tconst gen = new PerlinNoiseGenerator(data.perlinSeed, data.pi)\n\tfor(let x = perlinOffset; x < perlinOffset + perlinSize; x++){\n\t\tfor(let y = perlinOffset; y < perlinOffset + perlinSize; y++){\n\t\t\tsum += gen.get((x + 0.5) / perlinResolution, (y + 0.5) / perlinResolution)\n\t\t}\n\t}\n\treturn sum\n}\n\nconst renderSvgPath = (path: string) => {\n\tconst svg = svgTag({tag: \"svg\"}, [\n\t\tsvgTag({tag: \"path\", attrs: {d: path}})\n\t])\n\tsvg.setAttribute(\"viewBox\", \"-1 -1 100 100\")\n\treturn svg\n}","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"1L6a6\")).toString();","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;",".button,\n.buttonSmall {\n  cursor: pointer;\n  border-radius: 8px;\n  background-color: #222;\n  color: #aaa;\n  z-index: 1;\n}\n\n.button {\n  position: absolute;\n  left: 5vw;\n  right: 5vw;\n  top: 5vh;\n  padding: 1rem;\n  font-size: 40px;\n}\n\n.buttonSmall {\n  width: 90vw;\n  margin: 1rem 5vw;\n  padding: 0.5rem;\n}\n\n.table {\n  color: #aaa;\n  border-spacing: 0;\n  border-collapse: collapse;\n  margin: auto;\n  z-index: 2;\n\n  th {\n    background-color: #444;\n    border: 1px solid #555;\n    font-weight: bold;\n    padding: 2px;\n  }\n\n  td {\n    background-color: #222;\n    border: 1px solid #555;\n    text-align: left;\n    padding: 2px 4px;\n  }\n}\n\n.stuffDisplay {\n  opacity: 0.5;\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 200px;\n  > * {\n    width: 200px;\n  }\n  pointer-events: none;\n  z-index: 1;\n\n  display: flex;\n  justify-content: center;\n  align-items: stretch;\n}\n\nsvg {\n  path {\n    fill: #666;\n    stroke: #888;\n    stroke-width: 2;\n  }\n}\n","/** Returns parts of SVG string that form Catmull-Rom smoothed curve, passing through all the points.\nThose parts can be .join(\" \")-ed it to have a complete \"d\" attribute value for <path> */\nexport const getCatmullRomSvgPathForDotSequence = (points: {x: number, y: number}[], k: number = 1): (string | number)[] => {\n\tconst size = points.length\n\tconst result: (string | number)[] = [\"M\", points[0]!.x, points[0]!.y]\n\n\tfor(let i = 0; i < size; i++){\n\t\tconst {x: x0, y: y0} = points[((i - 1) + size) % size]!\n\t\tconst {x: x1, y: y1} = points[i]!\n\t\tconst {x: x2, y: y2} = points[(i + 1) % size]!\n\t\tconst {x: x3, y: y3} = points[(i + 2) % size]!\n\n\t\tconst cp1x = x1 + (x2 - x0) / 6 * k\n\t\tconst cp1y = y1 + (y2 - y0) / 6 * k\n\n\t\tconst cp2x = x2 - (x3 - x1) / 6 * k\n\t\tconst cp2y = y2 - (y3 - y1) / 6 * k\n\n\t\tresult.push(\"C\", cp1x, cp1y, cp2x, cp2y, x2, y2)\n\t}\n\n\treturn result\n}","import {makeRandomGenerator} from \"common/seeded_random\"\nimport {cos, sin} from \"sketches/fp_determinism_tester/trigonometry\"\nimport {XY} from \"sketches/random_rhombus_tilings/triangle_grid\"\n\nconst makeKey = (x: number, y: number) => (x * 0xffffff) + y\n\n/** Simple perlin noise generator.\nBehaves weirdly if ints are passed to get() - will always return zero\nKeep coords below 0xffffff */\nexport class PerlinNoiseGenerator {\n\tprivate readonly random: () => number\n\tprivate readonly gradients = new Map<number, XY>()\n\n\tconstructor(seed: number, private readonly pi: number = Math.PI) {\n\t\tthis.random = makeRandomGenerator(seed)\n\t}\n\n\tprivate randomVector(): XY {\n\t\tconst theta = this.random() * 2 * this.pi\n\t\treturn {x: cos(theta), y: sin(theta)}\n\t}\n\n\tprivate dotProductGrid(x: number, y: number, vx: number, vy: number): number {\n\t\tlet gradientVector = this.gradients.get(makeKey(vx, vy))\n\t\tif(!gradientVector){\n\t\t\tgradientVector = this.randomVector()\n\t\t\tthis.gradients.set(makeKey(vx, vy), gradientVector)\n\t\t}\n\t\tconst diffVector = {x: x - vx, y: y - vy}\n\t\treturn diffVector.x * gradientVector.x + diffVector.y * gradientVector.y\n\t}\n\n\tprivate smootherstep(x: number): number {\n\t\treturn 6 * x ** 5 - 15 * x ** 4 + 10 * x ** 3\n\t}\n\n\tprivate interp(x: number, a: number, b: number): number {\n\t\treturn a + this.smootherstep(x) * (b - a)\n\t}\n\n\t/** Returns perlin noise value in range (-1, 1) */\n\tget(x: number, y: number): number {\n\t\tconst xInt = Math.floor(x)\n\t\tconst yInt = Math.floor(y)\n\t\t// interpolate\n\t\tconst topLeft = this.dotProductGrid(x, y, xInt, yInt)\n\t\tconst topRight = this.dotProductGrid(x, y, xInt + 1, yInt)\n\t\tconst bottomLeft = this.dotProductGrid(x, y, xInt, yInt + 1)\n\t\tconst bottomRight = this.dotProductGrid(x, y, xInt + 1, yInt + 1)\n\t\tconst xTop = this.interp(x - xInt, topLeft, topRight)\n\t\tconst xBottom = this.interp(x - xInt, bottomLeft, bottomRight)\n\t\treturn this.interp(y - yInt, xTop, xBottom)\n\t}\n}","export const makeRandomGenerator = (seed: number): () => number => {\n\tconst m = 2 ** 35 - 31\n\tconst a = 185852\n\tlet s = seed % m\n\treturn () => (s = (s * a) % m) / m\n}","const doubleComparePrecision = 0.00000000000000000001\nconst M_PI = 3.1415927\nconst M_PI_2 = M_PI / 2\nconst M_PI_M_2 = M_PI * 2\n\nconst compare_float = (f1: number, f2: number): -1 | 0 | 1 => {\n\tif((f1 - doubleComparePrecision) < f2){\n\t\treturn -1\n\t} else if((f1 + doubleComparePrecision) > f2){\n\t\treturn 1\n\t} else {\n\t\treturn 0\n\t}\n}\n\nexport const cos = (x: number): number => {\n\tif(x < 0){\n\t\tx = -x\n\t}\n\n\tif(compare_float(x, M_PI_M_2) >= 0){\n\t\tx = x % M_PI_M_2\n\t}\n\n\tif((compare_float(x, M_PI) >= 0) && (compare_float(x, M_PI_M_2) === -1)){\n\t\tx -= M_PI\n\t\treturn ((-1) * (1 - (x * x / 2) * (1 - (x * x / 12) * (1 - (x * x / 30) * (1 - (x * x / 56) * (1 - (x * x / 90) * (1 - (x * x / 132) * (1 - (x * x / 182)))))))))\n\t}\n\treturn 1 - (x * x / 2) * (1 - (x * x / 12) * (1 - (x * x / 30) * (1 - (x * x / 56) * (1 - (x * x / 90) * (1 - (x * x / 132) * (1 - (x * x / 182)))))))\n}\n\nexport const sin = (x: number) => cos(x - M_PI_2)"],"names":["$7sHgZ","parcelRequire","$13ef1059f6997794$var$waitForFrame","Promise","ok","requestAnimationFrame","async","$13ef1059f6997794$export$f22da7240b7add18","root","btn","tag","class","$4le4a","button","onClick","textContent","setAttribute","testResults","testData","numbers","o1","o2","o3","o4","negZero","catmullRom","$13ef1059f6997794$var$runTests","x","Math","sin","cos","$g6UwN","sqrt","$dgZFu","getCatmullRomSvgPathForDotSequence","map","reduce","a","b","$13ef1059f6997794$var$calcPerlinNoiseChecksum","$13ef1059f6997794$var$runTheTests","data","table","$13ef1059f6997794$var$makeResultsTable","replaceWith","prepend","$13ef1059f6997794$var$makeCopyButton","$13ef1059f6997794$var$renderVisualStuff","e","console","error","appendChild","fetch","$parcel$interopDefault","$8xvCO","json","buttonSmall","arrs","name","bin","navigator","clipboard","writeText","JSON","stringify","replaceAll","dec","time","toFixed","tests","coldTimings","$13ef1059f6997794$var$makeTimings","coldResults","$13ef1059f6997794$var$runRoundOfTests","throwawayTimings","now","Date","hotTimings","hotResults","enrichedCold","$13ef1059f6997794$var$enrichWithTiming","enrichedHot","$13ef1059f6997794$var$insertAtEachNth","runCount","results","timings","suffix","res","index","timing","receivingArray","sourceArray","n","srcIndex","recIndex","result","Array","length","i","dblBuffer","DataView","ArrayBuffer","test","testTiming","startTime","performance","testResult","i1","testResultDec","setFloat64","testResultBin","i2","byteStr","getUint8","toString","push","catmullRomPath","join","stuffDisplay","$13ef1059f6997794$var$renderSvgPath","$13ef1059f6997794$var$renderPerlinGrid","$13ef1059f6997794$var$perlinOffset","pixelSize","canvas","attrs","width","$13ef1059f6997794$var$perlinSize","height","ctx","getContext","gen","$kCdOB","PerlinNoiseGenerator","perlinSeed","pi","y","noiseColor","floor","get","fillStyle","fillRect","sum","path","svg","svgTag","d","module","exports","URL","resolve","import","meta","url","$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","id","resolved","Error","$329408dd30245791$export$48710ed2dec0d923","$329408dd30245791$export$2ba01fb71ed41cb6","$329408dd30245791$export$f8c341fef5ba7d5c","$329408dd30245791$export$9852986a3ec5f6a0","$23fe750040db033b$export$dc761408bace8baa","points","k","size","x0","y0","x1","y1","x2","y2","x3","y3","cp1x","cp1y","cp2x","cp2y","$fH3rR","$e9ff637e511652fb$var$makeKey","$e9ff637e511652fb$export$5df0e553ffc4cfe","constructor","seed","PI","gradients","Map","this","random","makeRandomGenerator","randomVector","theta","dotProductGrid","vx","vy","gradientVector","set","diffVector","smootherstep","interp","xInt","yInt","topLeft","topRight","bottomLeft","bottomRight","xTop","xBottom","$fa672a406b773481$export$211cdad63e59713b","m","s","$0ac95f9d6cbe975a$var$M_PI","$0ac95f9d6cbe975a$var$M_PI_M_2","$0ac95f9d6cbe975a$var$compare_float","f1","f2","$0ac95f9d6cbe975a$export$50d414a77b60d802","$0ac95f9d6cbe975a$export$5de3937cb4b592ed"],"version":3,"file":"fp_determinism_tester.e78df858.js.map"}