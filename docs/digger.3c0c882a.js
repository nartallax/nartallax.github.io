function e(e,t,s,n){Object.defineProperty(e,t,{get:s,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirebf86;t.register("7sHgZ",(function(s,n){e(s.exports,"onMount",(()=>E)),e(s.exports,"initializeCardboardDom",(()=>R)),e(s.exports,"bindBox",(()=>L)),e(s.exports,"tag",(()=>_)),e(s.exports,"svgTag",(()=>M)),e(s.exports,"waitDocumentLoaded",(()=>P));var i=t("9H5KT");let r=Symbol("dom-value-link-no-value-known");class o{subscribeToDomValue(){}unsubscribeFromDomValue(){}constructor(e,t){this.box=e,this.options=t,this.lastKnownRawDomValue=r,this.subscribeDomBound=this.subscribeToDomValue.bind(this),this.unsubscribeDomBound=this.unsubscribeFromDomValue.bind(this),this.tryUpdateDomValueBound=this.tryUpdateDomValue.bind(this),this.updateBoxValueBound=this.updateBoxValue.bind(this)}canPushUpdates(){return this.subscribeToDomValue!==o.prototype.subscribeToDomValue&&(0,i.isWBox)(this.box)}updateBoxValue(){if(!(0,i.isWBox)(this.box))return;let e=this.getRawDomValue();this.lastKnownRawDomValue!==e&&(this.lastKnownRawDomValue=e,this.box.set(this.parseDomValue(e)))}tryUpdateDomValue(e){let t=this.getRawDomValue(),s=this.options.preferBoxValue||!(0,i.isWBox)(this.box);(t===this.lastKnownRawDomValue||s)&&(this.updateDomValue(e),this.lastKnownRawDomValue=this.getRawDomValue())}bind(e){this.canPushUpdates()&&(e.onInserted(this.updateBoxValueBound),e.onInserted(this.subscribeDomBound),e.onRemoved(this.unsubscribeDomBound)),e.isInDom&&this.subscribeToDomValue(),this.options.preferBoxValue||!(0,i.isWBox)(this.box)?e.watchAndRun(this.box,this.tryUpdateDomValueBound):(e.watch(this.box,this.tryUpdateDomValueBound),this.updateBoxValue())}unbind(e){this.canPushUpdates()&&(e.offInserted(this.updateBoxValueBound),e.offInserted(this.subscribeDomBound),e.offRemoved(this.unsubscribeDomBound),e.isInDom&&this.unsubscribeFromDomValue()),e.unwatch(this.tryUpdateDomValueBound)}}class a extends o{constructor(e,t,s){(0,i.isWBox)(t)&&(t=t.map((e=>e))),super(t,s),this.node=e}get element(){return this.options.element??(this.node instanceof HTMLElement?this.node:null)??document.body}getRawDomValue(){return(this.options.element??document.body).style.getPropertyValue(this.options.name)}updateDomValue(e){let t=this.options.name;null==e||""===e||"string"!=typeof e&&"number"!=typeof e?this.element.style.removeProperty(t):this.element.style.setProperty(t,e+"")}parseDomValue(){throw Error("There's no way to move value of CSS variable into box, because it could break types: CSS variable is always string, but box may be of different type. If you need to do that - do that explicitly by using element.style.getPropertyValue(name)")}}class l{constructor(e,t){this.timeoutMs=e,this.check=t,this.startTime=0,this.isRunning=!1}runCheckAndRequest(){let e=()=>{try{if(this.check()||Date.now()-this.startTime>this.timeoutMs)return void(this.isRunning=!1)}catch(e){throw this.isRunning=!1,e}h(e)};this.isRunning=!0,e()}run(){this.startTime=Date.now(),this.isRunning||this.runCheckAndRequest()}}let h=requestAnimationFrame??(e=>setTimeout(e,1e3/60)),u=new class{subscribe(e){this.handlers.add(e),this.isPatched||(this.isPatched=!0,this.patch())}unsubscribe(e){this.handlers.delete(e)}patch(){this.lastKnownLocation=window.location+"";let e=History.prototype;for(let t in e){let s;try{s=e[t]}catch(e){continue}if("function"!=typeof s)continue;let n=this,i=function(...e){let t=s.apply(this,e);return n.repeater.run(),t};e[t]=i}}tryCallHandlers(){let e=window.location+"";if(e===this.lastKnownLocation)return!1;for(let t of(this.lastKnownLocation=e,this.handlers))t();return!0}constructor(){this.handlers=new Set,this.lastKnownLocation="",this.isPatched=!1,this.repeater=new l(1e3,this.tryCallHandlers.bind(this))}};class d extends o{getRawDomValue(){return window.location+""}parseDomValue(e){let t=new URL(e),s="";return this.options.path&&(s+=t.pathname),this.options.search&&(s+=t.search),this.options.hash&&(s+=t.hash),s}updateDomValue(e){let t=new URL(e,window.location+"");this.options.search||(t.search=window.location.search),this.options.path||(t.pathname=window.location.pathname),this.options.hash||(t.hash=window.location.hash),t+""!=window.location+""&&("replace"===(this.options.history??"replace")?window.history.replaceState(null,"",t):window.history.pushState(null,"",t))}subscribeToDomValue(){let e=this.updateBoxValueBound;u.subscribe(e),this.options.hash&&window.addEventListener("hashchange",e)}unsubscribeFromDomValue(){let e=this.updateBoxValueBound;u.unsubscribe(e),this.options.hash&&window.removeEventListener("hashchange",e)}}let c=Symbol("cardboard-dom-binder-no-value");class p{constructor(e){this.node=e,this.beforeInsertedHandlers=null,this.afterInsertedHandlers=null,this.removedHandlers=null,this.watchedBoxes=null,this.domValueLinks=null,this.isExpectingInsertion=!1,this.isInDom=e.isConnected}onInserted(e,t){t?(this.beforeInsertedHandlers||=[]).push(e):(this.afterInsertedHandlers||=[]).push(e)}onRemoved(e){(this.removedHandlers||=[]).push(e)}offInserted(e,t){t?this.beforeInsertedHandlers=f(this.beforeInsertedHandlers,e):this.afterInsertedHandlers=f(this.afterInsertedHandlers,e)}offRemoved(e){this.removedHandlers=f(this.removedHandlers,e)}notifyBeforeInserted(){if(this.isInDom)return;this.isInDom=!0,this.isExpectingInsertion=!0;let e=this.watchedBoxes;if(e)for(let t=0;t<e.length;t++){let s=e[t],n=s.box.get();s.box.subscribe(s.handlerWrap),s.lastKnownValue!==n&&this.invokeBoxHandler(n,s,void 0)}b(this.beforeInsertedHandlers)}notifyAfterInserted(){this.isExpectingInsertion&&(this.isExpectingInsertion=!1,b(this.afterInsertedHandlers))}notifyAfterRemoved(){if(!this.isInDom)return;this.isInDom=!1,this.isExpectingInsertion=!1;let e=this.watchedBoxes;if(e)for(let t=0;t<e.length;t++){let s=e[t];s.box.unsubscribe(s.handlerWrap)}b(this.removedHandlers)}notifyAttachmentState(e){this.isInDom!==e&&(console.error(`A node was ${e?"inserted into":"removed from"} DOM tree using unexpected method or property. This could result in memory leaks and/or inconsistent state. Please investigate and report an error.`,this.node),e?this.notifyBeforeInserted():this.notifyAfterRemoved())}invokeBoxHandler(e,t,s){t.handler(e,t.box,s),t.lastKnownValue=e}subscribe(e,t,s){let n={box:e,handler:t,lastKnownValue:s?e.get():c,handlerWrap:(e,t,s)=>this.invokeBoxHandler(e,n,s)};return this.isInDom&&n.box.subscribe(n.handlerWrap),(this.watchedBoxes||=[]).push(n),n}watch(e,t,s){this.subscribe(e,t,s)}watchAndRun(e,t){let s=this.subscribe(e,t);this.invokeBoxHandler(e.get(),s,void 0)}unwatch(e){let t=this.watchedBoxes?.filter((t=>t.handler!==e||(t.box.unsubscribe(t.handlerWrap),!1)));this.watchedBoxes=!t||t.length<0?null:t}addDomValueLink(e){(this.domValueLinks||=[]).push(e),e.bind(this)}removeDomValueLink(e){if(!this.domValueLinks)return;let t=this.domValueLinks.filter((t=>t.options!==e||(t.unbind(this),!1)));this.domValueLinks=0===t.length?null:t}}function f(e,t){if(!e||1===e.length&&e[0]===t)return null;let s=[];for(let n=0;n<e.length;n++){let i=e[n];i!==t&&s.push(i)}return s}function b(e){if(e)for(let t=0;t<e.length;t++)e[t]()}let m=[Node,Element,HTMLElement,SVGElement],y=null;function x(e){let t=Array(e.length);for(let s=0;s<e.length;s++)t[s]=e[s];return t}function g(e,t){w(e,(e=>function(...s){let n=e.apply(this,s);return t.apply(this,s),n}))}function w(e,t){for(let s of m){let n=s.prototype[e];if("function"==typeof n&&!y?.has(n))try{let i=t(n);y?.add(i),i.originalNonPatchedMethod=n,s.prototype[e]=i}catch(t){console.error("Failed to monkeypatch "+e+" method on "+s.name+": "+t)}}}function v(e,t){for(let s of m)try{let n=Object.getOwnPropertyDescriptor(s.prototype,e);if(!n||"function"!=typeof n.set||y?.has(n.set))continue;let i=t(n.set);y?.add(i),Object.defineProperty(s.prototype,e,{...n,set:i})}catch(t){console.error("Failed to monkeypatch "+e+" property on "+s.name+": "+t)}}class I{startInsertOperation(e){this.ongoingInsertOperationsCount++,this.markNodeInserted(e)}endInsertOperation(){this.ongoingInsertOperationsCount--,0===this.ongoingInsertOperationsCount&&this.nodesInTree.clear()}markNodeInserted(e){this.nodesInTree.add(e);for(let t=0;t<e.childNodes.length;t++)this.markNodeInserted(e.childNodes[t])}markNodeRemoved(e){this.nodesInTree.delete(e);for(let t=0;t<e.childNodes.length;t++)this.markNodeRemoved(e.childNodes[t])}isInserted(e){return e.isConnected||this.nodesInTree.has(e)}constructor(){this.nodesInTree=new Set,this.ongoingInsertOperationsCount=0}}function V(e){return Array.isArray(e)}function D(e,t){return e?Array.isArray(e)?[{},e]:[e,t]:[{},t]}function B(e,t,s){let n=null;if("class"in t&&(n=function(e,t,s,n){let r=function e(t,s=[]){if(Array.isArray(t))for(let n of t)e(n,s);else s.push(t);return s}(s);for(let s of r)if((0,i.isRBox)(s))(e||=U(t)).watch(s,o,!0);else if(s&&"object"==typeof s)for(let n in s){let r=s[n];(0,i.isRBox)(r)&&(e||=U(t)).watch(r,o,!0)}function o(){let e=[];for(let t of r)if(t&&"object"==typeof t&&!(0,i.isRBox)(t))for(let s in t)(0,i.unbox)(t[s])&&e.push(s);else{let s=(0,i.unbox)(t);s&&e.push(s)}n(e.join(" "))}return o(),e}(n,e,t.class,(t=>e.classList.value=t))||n),t.attrs)for(let s in t.attrs)n=A(n,e,t.attrs[s],(t=>{!1===t||void 0===t?e.removeAttribute(s):!0===t?e.setAttribute(s,s):e.setAttribute(s,t+"")}));for(let s in t)if(s.startsWith("on")){let i=t[s];if("beforeInserted"===s)(n||=U(e)).onInserted(i,!0);else if("afterInserted"===s)(n||=U(e)).onInserted(i,!1);else if("onRemoved"===s)(n||=U(e)).onRemoved(i);else{let t=s.charAt(2).toLowerCase()+s.substring(3);e.addEventListener(t,i,{passive:!0,capture:!1})}}if(s){let t=(t,n,r)=>function(e,t,s,n){if(s&&"array_item_update"===n?.type){let e=n.oldValue,t=s.get()[n.index];if(e instanceof Element&&t instanceof Element)return}let r=0;for(let s of t){let t=(0,i.unbox)(s);if(V(t))for(let s=0;s<t.length;s++)r=S(e,t[s],r);else r=S(e,t,r)}for(;e.childNodes.length>r;)e.removeChild(e.childNodes[e.childNodes.length-1])}(e,s,n,r);for(let r of s)(0,i.isRBox)(r)&&(n||=U(e)).watch(r,t,!0);t(null,void 0,void 0)}return n}function S(e,t,s){let n;if(null==t||!0===t||!1===t)return s;if(t instanceof Node)n=t;else{let i=t+"",r=e.childNodes[s];if(r instanceof Text)return r.textContent=i,s+1;n=document.createTextNode(i)}return e.childNodes[s]===n||(e.childNodes.length<=s?e.appendChild(n):e.insertBefore(n,e.childNodes[s])),s+1}function A(e,t,s,n){return!(0,i.isRBox)(s)||(0,i.isConstBox)(s)?n((0,i.unbox)(s),(0,i.constBoxWrap)(s),void 0):(e||=U(t)).watchAndRun(s,n),e}function E(e,t,s){let n=U(e),i=()=>{let e=t();if("function"==typeof e){let t=()=>{try{e()}finally{n.offRemoved(t)}};n.onRemoved(t)}};if(n.isInDom)switch(s?.ifInDom??"throw"){case"throw":throw Error("Node is already in DOM, that's unexpected");case"call":i()}n.onInserted(i,s?.beforeInserted)}let C=new WeakMap,k=new class{constructor(e){this.binders=e,this.observer=null}init(){this.observer||"undefined"==typeof MutationObserver||(this.observer=new MutationObserver(this.doWithRecords.bind(this)),this.observer.observe(document.body,{childList:!0,subtree:!0}))}shutdown(){this.observer&&(this.observer.disconnect(),this.observer=null)}collectEligibleNodesFromArray(e){let t=new Set;for(let s=0;s<e.length;s++)this.collectEligibleNodes(e[s],t);return t}collectEligibleNodes(e,t){this.binders.has(e)&&t.add(e);let s=e.childNodes;for(let e=0;e<s.length;e++)this.collectEligibleNodes(s[e],t)}doWithRecords(e){let t=[],s=[];for(let n=0;n<e.length;n++){let i=e[n];for(let e=0;e<i.addedNodes.length;e++)t.push(i.addedNodes[e]);for(let e=0;e<i.removedNodes.length;e++)s.push(i.removedNodes[e])}let n=this.collectEligibleNodesFromArray(t),i=this.collectEligibleNodesFromArray(s);for(let e of n)i.has(e)||this.binders.get(e).notifyAttachmentState(!0);for(let e of i)n.has(e)||this.binders.get(e).notifyAttachmentState(!1)}}(C),N=new class{constructor(e){this.binders=e,this.isInit=!1,this.projectedTreeState=new I}isInitialized(){return this.isInit}init(){this.isInit||(this.isInit=!0,function(e,t){y=new Set;let s=(t,s)=>{t instanceof Node&&e(t,s)},n=e=>function(...n){for(let e=0;e<n.length;e++)s(n[e],this);let i=e.apply(this,n);for(let e=0;e<n.length;e++){let s=n[e];s instanceof Node&&t(s)}return i},i=s=>function(...n){e(n[0],this);let i=s.apply(this,n);return t(n[0]),i};w("insertBefore",i),w("after",i),w("before",i),w("appendChild",i),w("append",n),w("prepend",n),w("insertAdjacentElement",(s=>function(...n){e(n[1],this);let i=s.apply(this,n);return t(n[1]),i})),g("removeChild",t),g("remove",(function(){t(this)})),w("replaceChild",(s=>function(...n){e(n[0],this);let i=s.apply(this,n);return t(n[1]),t(n[0]),i})),w("replaceChildren",(e=>function(...n){let i=x(this.childNodes);for(let e=0;e<n.length;e++)s(n[e],this);let r=e.apply(this,n);for(let e=0;e<i.length;e++)t(i[e]);for(let e=0;e<n.length;e++){let s=n[e];s instanceof Node&&t(s)}return r})),w("replaceWith",(e=>function(...n){for(let e=0;e<n.length;e++)s(n[e],this);let i=e.apply(this,n);t(this);for(let e=0;e<n.length;e++){let s=n[e];s instanceof Node&&t(s)}return i})),w("setHTML",(e=>function(...s){let n=x(this.childNodes),i=e.apply(this,s);for(let e=0;e<n.length;e++)t(n[e]);return i})),v("innerHTML",(e=>function(...s){let n=x(this.childNodes),i=e.apply(this,s);for(let e=0;e<n.length;e++)t(n[e]);return i})),v("outerHTML",(e=>function(...s){let n=e.apply(this,s);return t(this),n})),v("textContent",(e=>function(...s){let n=x(this.childNodes),i=e.apply(this,s);for(let e=0;e<n.length;e++)t(n[e]);return i})),y=null}(this.beforeInserted.bind(this),this.afterRemovedOrInserted.bind(this)))}collectBinders(e,t=[]){let s=this.binders.get(e);s&&t.push(s);for(let s=0;s<e.childNodes.length;s++)this.collectBinders(e.childNodes[s],t);return t}beforeInserted(e,t){if(this.projectedTreeState.isInserted(t)){this.projectedTreeState.startInsertOperation(e);try{let t=this.collectBinders(e);for(let e=0;e<t.length;e++){let s=t[e];this.projectedTreeState.isInserted(s.node)&&s.notifyBeforeInserted()}}finally{this.projectedTreeState.endInsertOperation()}}}afterRemovedOrInserted(e){e.parentNode||this.projectedTreeState.markNodeRemoved(e);let t=this.collectBinders(e);for(let e=0;e<t.length;e++){let s=t[e];if(s.node.isConnected)s.notifyAfterInserted();else{if(this.projectedTreeState.isInserted(s.node))continue;s.notifyAfterRemoved()}}}}(C),R=async()=>{k.init(),N.init()},U=e=>{if(!N.isInitialized())throw Error("Cardboard DOM is not initialized! You need to call initializeCardboardDom() first.");let t=C.get(e);return t||(t=new p(e),C.set(e,t)),t};function L(e,t,s,n){for(let r of V(t)?t:[t])"function"==typeof s?function(e,t,s,n){(n?.dontCallImmediately?function(e,t,s,n){return!(0,i.isRBox)(s)||(0,i.isConstBox)(s)||(e||=U(t)).watch(s,n),e}:A)(null,e,t,s)}(e,r,s,n):K(e,r,s)}function K(e,t,s){let n,r=(0,i.constBoxWrap)(t),o=U(e);switch(s.type){case"localStorage":n=new T(r,s);break;case"cssVariable":n=new a(e,r,s);break;case"url":n=new d(r,s)}o.addDomValueLink(n)}class T extends o{getRawDomValue(){return localStorage.getItem(this.options.key)}updateDomValue(e){let t=this.options.key,s=this.options.serialize(e);null===s?localStorage.removeItem(t):localStorage.setItem(t,s)}parseDomValue(e){return this.options.parse(e)}}function _(e,t){let[s,n]=D(e,t),i=document.createElement(s.tag||"div"),r=B(i,s,n);if(s.style)for(let e in s.style){let t=s.style[e];r=A(r,i,t,(t=>{null==t?i.style.removeProperty(e):i.style[e]=t}))}return i}function M(e,t){let[s,n]=D(e,t),i=document.createElementNS("http://www.w3.org/2000/svg",s.tag||"g");return"svg"===s.tag&&i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),B(i,s,n),i}function P(){return new Promise((e=>{let t=()=>("interactive"===document.readyState||"complete"===document.readyState)&&(document.removeEventListener("readystatechange",t,!1),e(),!0);t()||document.addEventListener("readystatechange",t,!1)}))}})),t.register("9H5KT",(function(t,s){e(t.exports,"isRBox",(()=>k)),e(t.exports,"unbox",(()=>C)),e(t.exports,"isWBox",(()=>N)),e(t.exports,"box",(()=>D)),e(t.exports,"constBoxWrap",(()=>E)),e(t.exports,"isConstBox",(()=>R));class n{calculate(e,t,s){let n=e.revision,i=e.calculate(t,s);e.revision===n&&("recalc_on_get"===s?.type&&s.owner===e?e.set(i,t,s):e.set(i,t)),this.updateKnownDependencyValues()}}class i extends n{constructor(e){for(let t of(super(),this.rawDependencies=e,this.boxMap=new Map,e))k(t)&&this.boxMap.set(t,t.get())}updateKnownDependencyValues(){for(let e of this.boxMap.keys())this.boxMap.set(e,e.get())}getDependencyValues(){let e=Array(this.rawDependencies.length);for(let t=0;t<this.rawDependencies.length;t++)e[t]=C(this.rawDependencies[t]);return e}subscribeToDependencies(e){for(let t of this.boxMap.keys())t.subscribe(e)}unsubscribeFromDependencies(e){for(let t of this.boxMap.keys())t.unsubscribe(e)}didDependencyListChange(){for(let[e,t]of this.boxMap)if(e.get()!==t)return!0;return!1}setDependencyValues(e){for(let t=0;t<this.rawDependencies.length;t++){let s=this.rawDependencies[t],n=e[t];if(N(s))s.set(n);else{if(C(s)!==n)throw Error("Cannot update value of readonly dependency "+s)}}}isDependency(e){return this.boxMap.has(e)}}class r extends n{constructor(e){super(),this.dependency=e,this.lastKnownDependencyValue=C(e)}updateKnownDependencyValues(){this.lastKnownDependencyValue=C(this.dependency)}subscribeToDependencies(e){k(this.dependency)&&this.dependency.subscribe(e)}unsubscribeFromDependencies(e){k(this.dependency)&&this.dependency.unsubscribe(e)}didDependencyListChange(){return this.lastKnownDependencyValue!==C(this.dependency)}getDependencyValues(){return[C(this.dependency)]}setDependencyValues(e){if(N(this.dependency))this.dependency.set(e[0]);else{if(C(this.dependency)!==e[0])throw Error("Cannot update value of readonly dependency "+this.dependency)}}isDependency(e){return e===this.dependency}}let o=Symbol("AbsentBoxValue");class a{haveSubscribers(){return this.subscriberList.haveSubscribers()}set(e,t,s){this.value!==e&&(this.value=e,this.notifyOnValueChange(e,t,s))}get(){if(this.value===o)throw Error("This box is disposed; no value can be get");return this.value}dispose(){this.value=o,this.subscriberList.dispose()}subscribe(e){this.subscriberList.subscribe(e,this.get())}unsubscribe(e){this.subscriberList.unsubscribe(e)}notifyOnValueChange(e,t,s){this.subscriberList.callSubscribers(e,t,s)}map(e,t){return t?new b(this,e,t):new f(this,e,l)}prop(e){return N(this)?new x(this,e):new y(this,e)}getArrayContext(e){return new K(this,e,h)}mapArrayElements(e,t){return function(e,t,s){let n=new Map,i=s?new Map:null,r=e=>{let s=new Set(n.keys()),r=e.map(((e,r)=>{s.delete(e);let o=n.get(e);return!o&&(o=t(e,r),n.set(e,o),i&&i.set(o,e)),o}));if(i)for(let e of s)i.delete(n.get(e));for(let e of s)n.delete(e);return r};return i&&s?e.map(r,(e=>{let t=new Set(i.keys()),r=e.map(((e,r)=>{t.delete(e);let o=i.get(e);return o||(o=s(e,r),n.set(o,e),i.set(e,o)),o}));for(let e of t)n.delete(i.get(e)),i.delete(e);return r})):e.map(r)}(this,e,t)}mapArray(e,t){return new K(this,e,t).getValueArrayBox()}setProp(e,t){let s=this.get();s[e]!==t&&this.set({...s,[e]:t},void 0,{type:"property_update",propName:e})}setElementAtIndex(e,t){let s=this.get();if(s[e]===t)return;let n=s[e],i=[...s];i[e]=t,this.set(i,void 0,{type:"array_item_update",index:e,oldValue:n})}insertElementsAtIndex(e,t){if(0===t.length)return;let s=this.get();this.checkInsertIndex(s,e);let n=[...s.slice(0,e),...t,...s.slice(e)];this.set(n,void 0,{type:"array_items_insert",index:e,count:t.length})}insertElementAtIndex(e,t){this.insertElementsAtIndex(e,[t])}appendElement(e){this.insertElementsAtIndex(this.get().length,[e])}appendElements(e){this.insertElementsAtIndex(this.get().length,e)}prependElement(e){this.insertElementsAtIndex(0,[e])}prependElements(e){this.insertElementsAtIndex(0,e)}checkInsertIndex(e,t){if(t<0)throw Error(`Cannot insert anything in negative index (passed index = ${t})`);if(t>e.length)throw Error(`Cannot insert anything in index beyond array length (passed index = ${t}, array length = ${e.length}); this will create sparse array, which is bad in multiple ways and should always be avoided.`)}deleteElementsAtIndex(e,t){if(t<1)return;let s=this.get();if(this.checkDeleteIndex(s,e),(t=Math.min(t,s.length-e))<1)return;let n=[];for(let i=0;i<t;i++){let t=e+i,r=s[t];n.push({value:r,index:t})}let i=[...s.slice(0,e),...s.slice(e+t)];this.set(i,void 0,{type:"array_items_delete",indexValuePairs:n})}deleteElementAtIndex(e){this.deleteElementsAtIndex(e,1)}checkDeleteIndex(e,t){if(t<0)throw Error(`Cannot delete element at negative index (passed index = ${t})`);if(t>e.length-1)throw Error(`Cannot delete anything starting from beyond array length (passed index = ${t}, array length = ${e.length})`)}deleteElements(e){this.deleteElementsInternal(e,!1)}deleteElement(e){this.deleteElementsInternal(e,!0)}deleteElementsInternal(e,t){let s=this.get(),n=[],i=[];for(let r=0;r<s.length;r++){let o=s[r];if(e(o,r))i.push(o);else if(n.push({value:o,index:r}),t){i.push(...s.slice(r+1));break}}if(0!==n.length)this.set(i,void 0,{type:"array_items_delete",indexValuePairs:n});else if(t)throw Error("Expected to find exactly one element to delete, but found none (predicate = "+e+")")}deleteAllElements(){this.set([],void 0,{type:"array_items_delete_all"})}constructor(){this.value=o,this.subscriberList=new L(this)}}let l=()=>{throw Error("This box does not support reverse-mapping")},h=()=>null;class u extends a{subscribe(e){this.haveSubscribers()||this.onFirstSubscriber(),super.subscribe(e)}unsubscribe(e){let t=this.haveSubscribers();super.unsubscribe(e),t&&!this.haveSubscribers()&&this.onLastUnsubscriber()}}class d extends u{constructor(e){super(),this.dependencyList=e,this.revision=0,this.forcedShouldRecalculate=!1}calculateAndUpdate(e,t){this.forcedShouldRecalculate=!1,this.dependencyList.calculate(this,e,t)}notifyOnValueChange(e,t,s){this.revision++,super.notifyOnValueChange(e,t,s)}onUpstreamChange(e,t){this.calculateAndUpdate(e,t)}shouldRecalculate(){return!!this.forcedShouldRecalculate||this.value===o||!this.haveSubscribers()&&!!this.dependencyList.didDependencyListChange()}recalculateIfShould(e,t){this.shouldRecalculate()&&this.calculateAndUpdate(e,t)}set(e,t,s){return!this.haveSubscribers()&&this.shouldRecalculate()&&(this.value=o),super.set(e,t,s)}get(){return this.recalculateIfShould(void 0,{type:"recalc_on_get",owner:this}),super.get()}onFirstSubscriber(){this.dependencyList.subscribeToDependencies(this),this.shouldRecalculate()&&this.calculateAndUpdate(void 0,void 0)}onLastUnsubscriber(){this.dependencyList.unsubscribeFromDependencies(this)}}class c extends d{constructor(e){super(new r(e)),this.upstream=e}calculate(e,t){return this.makeDownstreamValue(this.upstream.get(),t)}notifyOnValueChange(e,t,s){t!==this.upstream&&this.updateUpstreamWith(e,s),super.notifyOnValueChange(e,t,s)}calculateAndUpdate(e,t){e||(e=this.upstream),super.calculateAndUpdate(e,t)}}class p extends c{constructor(e,t,s){super(e),this.makeDownstreamValue=t,this.makeUpstreamValue=s}toString(){return`MapBox(${U(this.value)})`}updateUpstreamWith(e,t){this.upstream.set(this.makeUpstreamValue(e,t),this)}}class f extends p{}class b extends p{}class m extends c{constructor(e,t){super(e),this.propName=t}toString(){return`PropBox(${U(this.value)})`}makeDownstreamValue(e){return e[this.propName]}updateUpstreamWith(e){let t={...this.upstream.get(),[this.propName]:e};this.upstream.set(t,this,{type:"property_update",propName:this.propName})}}class y extends m{}class x extends m{}class g extends u{constructor(e,t){super(),this.arrayContext=e,this.value=t}toString(){return`ArrayContextControlledBox(${U(this.value)})`}dispose(){this.haveSubscribers()&&this.arrayContext.onDownstreamUnsubscription(),super.dispose()}onFirstSubscriber(){this.value!==o&&this.arrayContext.onDownstreamSubscription()}onLastUnsubscriber(){this.value!==o&&this.arrayContext.onDownstreamUnsubscription()}checkIfStillAttached(){if(!this.arrayContext.isItemBoxAttached(this))throw Error("This array-linked box "+this+" is no longer attached to its upstream. Element it was attached to was removed from upstream, or was absent in some time in the past.")}get(){return this.arrayContext.isItemBoxAttached(this)&&this.arrayContext.tryUpdate(),this.checkIfStillAttached(),super.get()}}class w extends g{constructor(e,t,s,n){super(e,t),this.index=s,this.key=n}toString(){return`ArrayItemBox(${U(this.key)}, ${U(this.value)})`}set(e,t){this.checkIfStillAttached(),super.set(e,t)}notifyOnValueChange(e,t,s){t!==this.arrayContext&&this.arrayContext.onDownstreamChange(this,e),super.notifyOnValueChange(e,t,s)}deleteArrayElement(){this.checkIfStillAttached(),this.arrayContext.upstream.deleteElementAtIndex(this.index)}}class v extends w{}class I extends w{}class V extends d{constructor(e,t,s){super(1===e.length?new r(e[0]):new i(e)),this.calculateFn=t,this.reverseCalculateFn=s}toString(){return`CalcBox(${U(this.value)})`}calculate(){let e=this.dependencyList.getDependencyValues();return this.calculateFn(...e)}notifyOnValueChange(e,t,s){let n=this.dependencyList.isDependency(t),i=!t&&"recalc_on_get"===s?.type;!!!this.reverseCalculateFn||n||i||this.updateUpstream(e),super.notifyOnValueChange(e,t,s)}updateUpstream(e){let t=this.dependencyList.getDependencyValues(),s=this.reverseCalculateFn(e,...t);this.dependencyList.setDependencyValues(s)}}let D=e=>new B(e);class B extends a{constructor(e){super(),this.value=e}toString(){return`ValueBox(${U(this.value)})`}}class S{constructor(e){if(this.value=e,e===o)throw Error("ConstBox must always have a value")}toString(){return`ConstBox(${U(this.value)})`}get(){return this.value}subscribe(){}unsubscribe(){}haveSubscribers(){return!1}map(e){return new S(e(this.value,void 0))}prop(e){return new S(this.value[e])}getArrayContext(e){return new T(this,e)}mapArrayElements(e){return new S(this.value.map(((t,s)=>e(t,s))))}mapArray(e,t){let s=new Map;return new S(this.value.map(((n,i)=>{let r=e(n,i);if(s.has(r))return s.get(r);let o=t(new S(n),i);return s.set(r,o),o})))}set(){A()}setProp(){A()}setElementAtIndex(){A()}insertElementsAtIndex(){A()}insertElementAtIndex(){A()}appendElement(){A()}appendElements(){A()}prependElement(){A()}prependElements(){A()}deleteElementsAtIndex(){A()}deleteElementAtIndex(){A()}deleteElements(){A()}deleteElement(){A()}deleteAllElements(){A()}deleteArrayElement(){A()}dispose(){A()}}function A(){throw Error("You can't change anything about value of const box")}function E(e){return k(e)?e:(e=>new S(e))(e)}function C(e){return k(e)?e.get():e}function k(e){return e instanceof a||R(e)}function N(e){return e instanceof B||e instanceof b||e instanceof x||e instanceof I}function R(e){return e instanceof S}function U(e){return"symbol"==typeof e?e.toString():JSON.stringify(e)}S.prototype.isConstBox=!0;class L{constructor(e){this.owner=e,this.subscriptions=null,this.propBoxInternalSubscriptions=null}haveSubscribers(){return!(!this.subscriptions&&!this.propBoxInternalSubscriptions)}callSubscribers(e,t,s){this.notifyPropSubscribers(e,t,s),this.notifySubscribers(e,t,s),_.run()}notifySubscribers(e,t,s){if(this.subscriptions)for(let n of this.subscriptions.values())n.receiver!==t?_.enqueueUpdate(new M(n,e,s)):n.lastKnownValue=e}notifyPropSubscribers(e,t,s){if(this.propBoxInternalSubscriptions){if(s&&"property_update"===s.type){let n=this.propBoxInternalSubscriptions.get(s.propName);return void(n&&this.notifyPropSubscriptionArray(e,n,t,s))}for(let n of this.propBoxInternalSubscriptions.values())this.notifyPropSubscriptionArray(e,n,t,s)}}notifyPropSubscriptionArray(e,t,s,n){for(let i=0;i<t.length;i++){let r=t[i];r.receiver!==s?_.enqueueUpdate(new M(r,e,n)):r.lastKnownValue=e}}subscribe(e,t){let s={lastKnownValue:t,receiver:e,provider:this.owner};if(e instanceof m){let t=this.propBoxInternalSubscriptions||=new Map,n=t.get(e.propName);if(!n)return n=[s],void t.set(e.propName,n);for(let t=0;t<n.length;t++)if(n[t].receiver===e)return;return void n.push(s)}let n=this.subscriptions||=new Map;n.has(e)||n.set(e,s)}unsubscribe(e){if(e instanceof m){if(!this.propBoxInternalSubscriptions)return;let t=this.propBoxInternalSubscriptions.get(e.propName);if(!t)return;let s=null;t=t.filter((t=>t.receiver!==e||(s=t,!1))),s&&_.deleteUpdate(s),0===t.length?(this.propBoxInternalSubscriptions.delete(e.propName),0===this.propBoxInternalSubscriptions.size&&(this.propBoxInternalSubscriptions=null)):this.propBoxInternalSubscriptions.set(e.propName,t)}this.subscriptions&&(this.subscriptions.delete(e),0===this.subscriptions.size&&(this.subscriptions=null))}dispose(){if(this.subscriptions)for(let e of this.subscriptions.keys())"function"!=typeof e&&e.dispose()}}class K{constructor(e,t,s){this.upstream=e,this.getKey=t,this.getValue=s,this.pairs=new Map,this.childSubCount=0,this.lastKnownUpstreamValue=null,this.mappedValueBox=null}tryUpdate(e){if(!e&&this.childSubCount>0)return;let t=this.upstream.get();t!==this.lastKnownUpstreamValue&&this.onUpstreamChange(this.upstream,void 0,t)}makeChildBox(e,t,s){let n=N(this.upstream)?new I(this,e,t,s):new v(this,e,t,s),i={box:n,value:null};return this.pairs.set(s,i),i.value=this.getValue(n,t),i}onUpstreamChange(e,t,s){let n;s??=this.upstream.get(),this.lastKnownUpstreamValue=s;let i=!0;switch(t?.type){case"array_item_update":{let e=s[t.index],r=this.getKey(e,t.index),o=this.pairs.get(r);if(o)o.box.set(e,this),i=!1;else{let s=this.getKey(t.oldValue,t.index),i=this.pairs.get(s);if(!i)throw Error("Array element is not found by key "+s);this.pairs.delete(s),this.makeChildBox(e,t.index,r),n={type:"array_item_update",index:t.index,oldValue:i.value}}break}case"array_items_insert":{let e=Array(t.count);for(let{box:e}of this.pairs.values())e.index>=t.index&&(e.index+=t.count);for(let n=0;n<t.count;n++){let i=t.index+n,r=s[i],o=this.getKey(r,i);if(this.pairs.get(o))throw Error("Duplicate key: "+o);let a=this.makeChildBox(r,i,o);e[n]=a.value}n={type:"array_items_insert",count:t.count,index:t.index};break}case"array_items_delete":{let e=Array(t.indexValuePairs.length);for(let s=0;s<t.indexValuePairs.length;s++){let{index:n,value:i}=t.indexValuePairs[s],r=this.getKey(i,n),o=this.pairs.get(r);if(!o)throw Error("Tried to delete item at key "+r+", but there's no item for that key.");o.box.dispose(),this.pairs.delete(r),e[s]={index:n,value:o.value}}this.updateAllIndex(s),n={type:"array_items_delete",indexValuePairs:e};break}case"array_items_delete_all":for(let e of this.pairs.values())e.box.dispose();this.pairs.clear(),n={type:"array_items_delete_all"};break;default:{let e=new Set(this.pairs.keys());for(let t=0;t<s.length;t++){let n=s[t],i=this.getKey(n,t),r=this.pairs.get(i);if(r){if(!e.has(i))throw Error("Constraint violated, key is not unique: "+i);r.box.set(n,this),r.box.index=t}else this.makeChildBox(n,t,i);e.delete(i)}for(let t of e){this.pairs.get(t).box.dispose(),this.pairs.delete(t)}}}null!==this.mappedValueBox&&i&&this.mappedValueBox.set(this.makeValuesArray(),this,n)}updateAllIndex(e){for(let t=0;t<e.length;t++){let s=e[t],n=this.getKey(s,t),i=this.pairs.get(n);i&&(i.box.index=t)}}onDownstreamChange(e,t){let s=this.getKey(t,e.index);if(s!==e.key)throw Error("Array item box changed key, which is not allowed; was: "+e.key+", now "+s);let n=this.upstream.get();this.childSubCount<1&&(this.tryUpdate(),e.checkIfStillAttached());let i=[...n],r=i[e.index];i[e.index]=t,this.lastKnownUpstreamValue=i,this.upstream.set(i,this,{type:"array_item_update",index:e.index,oldValue:r})}onDownstreamSubscription(){this.childSubCount++,1===this.childSubCount&&(this.tryUpdate(!0),this.upstream.subscribe(this))}onDownstreamUnsubscription(){this.childSubCount--,0===this.childSubCount&&this.unsubscribeFromUpstream()}unsubscribeFromUpstream(){this.upstream.unsubscribe(this)}getBoxes(){this.tryUpdate();let e=this.upstream.get(),t=Array(e.length);for(let s=0;s<e.length;s++){let n=e[s],i=this.getKey(n,s),r=this.pairs.get(i);if(!r)throw Error("Cannot get array item box list: no downstream box for key "+i);t[s]=r.box}return t}getBoxForKey(e){this.tryUpdate();let t=this.pairs.get(e);if(!t)throw Error("No box for key "+e);return t.box}isItemBoxAttached(e){return e instanceof w?this.pairs.get(e.key)?.box===e:this.mappedValueBox===e}dispose(){for(let e of(this.lastKnownUpstreamValue=null,this.pairs.values()))e.box.dispose()}toString(){return`ArrayContext(${this.getKey})`}getValueArrayBox(){return this.mappedValueBox||(this.mappedValueBox=new g(this,this.makeValuesArray())),this.mappedValueBox}makeValuesArray(){if(this.tryUpdate(),!this.lastKnownUpstreamValue)throw Error("Array context update failed: no known upstream value (wtf?)");let e=Array(this.pairs.size);for(let t=0;t<this.lastKnownUpstreamValue.length;t++)e[t]=this.pairs.get(this.getKey(this.lastKnownUpstreamValue[t],t)).value;return e}}class T{constructor(e,t){this.upstream=e,this.getKey=t,this.boxMap=null,this.boxArray=null}getBoxForKey(e){if(!this.boxMap){this.boxMap=new Map;let e=this.upstream.get();for(let t=0;t<e.length;t++){let s=e[t],n=this.getKey(s,t);if(this.boxMap.has(n))throw Error("Duplicate array key: "+n);this.boxMap.set(n,new S(s))}}let t=this.boxMap.get(e);if(!t)throw Error("No box for key "+e);return t}getBoxes(){if(!this.boxArray){let e=this.upstream.get();this.boxArray=e.map((e=>new S(e)))}return[...this.boxArray]}}let _=new class{getSubQueue(e){return"function"==typeof e?this.subQueues[2]:e instanceof V||e instanceof p?this.subQueues[1]:this.subQueues[0]}withUpdatesPaused(e){this.pauseLevel++;try{return e()}finally{this.pauseLevel--,this.run()}}enqueueUpdate(e){let t=this.getSubQueue(e.subscription.receiver);t.get(e.subscription)&&(e.meta=void 0),e.value===e.subscription.lastKnownValue?t.delete(e.subscription):t.set(e.subscription,e)}deleteUpdate(e){this.getSubQueue(e.receiver).delete(e)}run(){if(!(this.isRunning||this.pauseLevel>0)){this.isRunning=!0;try{this.runInternal()}finally{this.isRunning=!1}}}runInternal(){for(;;)for(let e=0;e<this.subQueues.length;e++){let t=this.subQueues[e],s=t.values().next().value;if(s){t.delete(s.subscription),s.deliver();break}if(e===this.subQueues.length-1)return}}constructor(){this.subQueues=[,,,].fill(null).map((()=>new Map)),this.isRunning=!1,this.pauseLevel=0}};class M{constructor(e,t,s){this.subscription=e,this.value=t,this.meta=s,(e.receiver instanceof V||e.receiver instanceof p)&&(e.receiver.forcedShouldRecalculate=!0)}deliver(){this.subscription.lastKnownValue=this.value;let e=this.subscription.receiver;e instanceof V||e instanceof p?e.forcedShouldRecalculate&&e.recalculateIfShould(this.subscription.provider,this.meta):"function"==typeof e?e(this.value,this.subscription.provider,this.meta):e.onUpstreamChange(this.subscription.provider,this.meta)}toString(){return`Update(${U(this.value)}, from ${this.subscription.provider} to ${this.subscription.receiver}${this.meta?", "+JSON.stringify(this.meta):""})`}}}));
//# sourceMappingURL=digger.3c0c882a.js.map
