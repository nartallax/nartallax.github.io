function t(t,e,r,i){Object.defineProperty(t,e,{get:r,set:i,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirebf86;e.register("hppz9",(function(r,i){t(r.exports,"main",(()=>n));var s=e("d1Qaj");async function n(t){const e={widthCells:15,heightCells:10,screenWidth:document.body.clientWidth,screenHeight:document.body.clientHeight,wallThickness:.1,colors:{terrainA:"#d45500",terrainB:"#aa4400",terrainEmpty:"#2b1100"},dramaticDrawTiming:{terrain:.5}},r=new(0,s.DiggerWorld)(e);t.appendChild(r.el),r.start(),r.digVertical(0,0,5),r.digVertical(0,0,4)}})),e.register("d1Qaj",(function(r,i){t(r.exports,"DiggerWorld",(()=>c));var s=e("1VHh9"),n=e("cZ4Y3"),o=e("aCP3q");let a;var l;(l=a||(a={}))[l.DramaticDrawTerrain=0]="DramaticDrawTerrain",l[l.Running=1]="Running";class c{constructor(t){this.options=t,this.state=a.Running,this.dramaticDrawProgress=0,this.raf=null,this.invalidatedRects=new(0,n.RectanlgeDeduplicator);const e=t.screenWidth/t.widthCells,r=t.screenHeight/(t.heightCells+1);this.cellSizePx=Math.floor(Math.min(e,r));const i=t.screenWidth-this.cellSizePx*t.widthCells;this.soilMarginLeft=Math.ceil(i/2),this.playgroundWidthPx=t.widthCells*this.cellSizePx,this.terrain=new(0,s.Bitmap)(this.cellSizePx**2*t.widthCells*t.heightCells),this.terrain.setAll(),this.el=(0,o.tag)({tagName:"canvas",attrs:{width:t.screenWidth,height:t.screenHeight}});const l=this.el.getContext("2d");if(!l)throw new Error("Browser can't canvas 2d");if(this.context=l,!requestAnimationFrame)throw new Error("Browser can't RAF")}drawTerrainPixelAt(t,e,r){this.context.fillStyle,this.context.fillStyle=r?((15&e)>8?(e+t&15)>8:(e-t&15)<8)?this.options.colors.terrainA:this.options.colors.terrainB:this.options.colors.terrainEmpty,this.context.fillRect(t,e,1,1)}redrawTerrainAt(t,e){this.drawTerrainPixelAt(t+this.soilMarginLeft,e+this.cellSizePx,this.terrain.get(e*this.playgroundWidthPx+t))}dramaticDrawInitialTerrain(t){const e=this.dramaticDrawProgress,r=this.options.screenWidth*(this.options.screenHeight-this.cellSizePx),i=r/this.options.dramaticDrawTiming.terrain,s=Math.floor(t*i);this.dramaticDrawProgress=Math.min(r,this.dramaticDrawProgress+s);for(let t=e;t<this.dramaticDrawProgress;t++){const e=t%this.options.screenWidth,r=(t-e)/this.options.screenWidth+this.cellSizePx;this.drawTerrainPixelAt(e,r,!0)}this.dramaticDrawProgress===r&&(this.state=a.Running,this.dramaticDrawProgress=0)}invalidate(t,e,r,i){this.invalidatedRects.add({x:t,y:e,w:r,h:i})}redrawInvalidatedRectangles(){for(const t of this.invalidatedRects.getNonIntersectingRects()){const e=t.x+t.w,r=t.y+t.h;for(let i=t.x;i<e;i++)for(let e=t.y;e<r;e++)this.redrawTerrainAt(i,e)}this.invalidatedRects.clear()}onTick(t){switch(this.state){case a.DramaticDrawTerrain:return void this.dramaticDrawInitialTerrain(t);case a.Running:return void this.redrawInvalidatedRectangles()}}reset(){this.state=a.DramaticDrawTerrain,this.dramaticDrawProgress=0}start(){if(this.raf)throw new Error("Already started");this.reset();let t=0;const e=r=>{this.raf=requestAnimationFrame(e);const i=Math.min(1e3/15,r-t)/1e3;t=r,this.onTick(i)};e(t)}stop(){if(!this.raf)throw new Error("Not started");cancelAnimationFrame(this.raf),this.raf=null}digVertical(t,e,r){if(e>r){r=e,e=e}const i=this.cellSizePx*(1-this.options.wallThickness),s=t*this.cellSizePx-i/2,n=s+i,o=e*this.cellSizePx,a=r*this.cellSizePx;for(let t=o;t<=a;t++){const e=t*this.playgroundWidthPx;for(let t=s;t<=n;t++)this.terrain.clear(e+t)}this.invalidate(s,o,n-s,a-o)}}})),e.register("1VHh9",(function(e,r){t(e.exports,"Bitmap",(()=>i));class i{constructor(t){if(this.size=t,t<0)throw new Error(`Expected non-negative as size, got ${t}`);t%8&&(t=8*Math.ceil(t/8)),this.arr=new Uint8Array(t>>3)}set(t){const e=this.arr,r=t>>3;e[r]=e[r]|1<<(7&t)}clear(t){const e=this.arr,r=t>>3;e[r]=e[r]&~(1<<(7&t))}get(t){return 0!=(this.arr[t>>3]&1<<(7&t))}setAll(){this.arr.fill(255)}clearAll(){this.arr.fill(0)}getOffsetsAsNumbers(t,e){if(7&t||7&e)throw new Error("Assertion failed, only byte-aligned start/length is supported");const r=[];let i=0;for(let s=0;s<e>>3;s++){const e=this.arr[(t>>3)+s];let n=1;for(;256!==n;)e&n&&r.push(i),i++,n<<=1}return r}setOffsetsByNumbers(t,e,r){if(7&t||7&e)throw new Error("Assertion failed, only byte-aligned start/length is supported");let i=!1,s=0,n=0,o=r[n];for(let a=0;a<e>>3;a++){const e=this.arr[(t>>3)+a];let l=0,c=1;for(;256!==c;){const t=s===o?c:0;i=i||(e&c)!==t,t&&(l|=c,n++,o=r[n]),s++,c<<=1}this.arr[(t>>3)+a]=l}return i}and(t,e){if(7&e)throw new Error("Assertion failed, only byte-aligned start/length is supported");let r=!1;for(let i=0;i<t.arr.length;i++){const s=this.arr[(e>>3)+i],n=s&t.arr[i];r=r||n!==s,this.arr[(e>>3)+i]=n}return r}orFromTheStart(t){if(t.arr.length>this.arr.length)throw new Error("Assertion failed, lengths are not equal");for(let e=0;e<t.arr.length;e++)this.arr[e]=this.arr[e]|t.arr[e]}}})),e.register("cZ4Y3",(function(e,r){t(e.exports,"RectanlgeDeduplicator",(()=>i));class i{rects=[];add(t){this.rects.push(t)}clear(){this.rects.length=0}*getNonIntersectingRects(){for(const t of this.groupByLumps()){const e=[...this.splitLump(t)];yield*l(e)}}*groupByLumps(){for(const t of s(this.rects,n("y","h")))yield*s(t,n("x","w"))}*splitLump(t){const e=o(t,"x","w"),r=o(t,"y","h");for(const i of t)for(const t of a(i,e,"x","w"))yield*a(t,r,"y","h")}}function*s(t,e){if(0===t.length)return;let r=t[0],i=[r],s=null;for(let n=1;n<t.length;n++){const o=t[n];s=e(r,o,s),s?i.push(o):(yield i,i=[o]),r=o}yield i}function n(t,e){return(r,i,s)=>{const n=s?s.a:r[t],o=s?s.b:r[t]+r[e];return i[t]+i[e]<n||i[t]>o?null:{a:Math.min(n,i[t]),b:Math.max(o,i[t]+i[e])}}}function o(t,e,r){const i=[];for(let s=0;s<t.length;s++){const n=t[s],o=n[e];i.push(o,o+n[r])}return i.sort(((t,e)=>t-e))}function*a(t,e,r,i){let s=e[0];for(let n=1;n<e.length;n++){const o=e[n];if(o===s)continue;const a=t[r];if(s<a)o>a&&(yield{...t,[i]:o-a});else{const e=t[i];if(!(o<a+e)){yield{...t,[r]:s,[i]:a+e-s};break}yield{...t,[r]:s,[i]:o-s}}s=o}}function*l(t){if(t.length<1)return;let e=(t=t.sort(((t,e)=>t.x-e.x||t.y-e.y)))[0];if(yield e,!(t.length<2))for(let r=1;r<t.length;r++){const i=t[r];i.x===e.x&&i.y===e.y&&i.h===e.h&&i.w===e.w||(yield i,e=i)}}})),e.register("aCP3q",(function(r,i){t(r.exports,"tag",(()=>c)),t(r.exports,"svgTag",(()=>h));var s=e("hIDiW"),n=e("hsvBG"),o=e("jM5hi");function a(t,e){return t?Array.isArray(t)||(0,n.isRBox)(t)?[{},t]:[t,e]:[{},e]}function l(t,e,r){let i=null;if(e.text){const r=e.text;(0,n.isRBox)(r)&&(i||=(0,s.getBinder)(t)).watch(r,(e=>{t.textContent=e+""})),t.textContent=(0,n.unbox)(r)+""}if(e.on)for(const r in e.on){const i=e.on[r];t.addEventListener(r,i,{passive:!0,capture:!1})}for(const r in e.attrs){const o=e.attrs[r];(0,n.isRBox)(o)&&(i||=(0,s.getBinder)(t)).watch(o,(e=>{null==e?t.removeAttribute(r):t.setAttribute(r,e+"")}));const a=(0,n.unbox)(o);null!=o&&t.setAttribute(r,a+"")}if(r){const e=e=>{const r=e.filter((t=>!!t));!function(t,e){for(let r=0;r<e.length;r++){const i=e[r],s=t.childNodes[r];s!==i&&(s?t.insertBefore(i,s):t.appendChild(i))}for(;t.childNodes[e.length];)t.childNodes[e.length].remove()}(t,r)};(0,n.isRBox)(r)&&(i||=(0,s.getBinder)(t)).watch(r,(t=>{e(t)})),e((0,n.unbox)(r))}return e.class&&(i=(0,o.makeClassname)(i,t,e.class,(e=>t.classList.value=e))||i),i}function c(t,e){const[r,i]=a(t,e),o=document.createElement(r.tagName||"div");let c=l(o,r,i);if(r.style)for(const t in r.style){const e=r.style[t];(0,n.isRBox)(e)&&(c||=(0,s.getBinder)(o)).watch(e,(e=>{o.style[t]=e+""})),o.style[t]=(0,n.unbox)(r.style[t])+""}return o}function h(t,e){const[r,i]=a(t,e),s=document.createElementNS("http://www.w3.org/2000/svg",r.tagName||"g");return"svg"===r.tagName&&s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),l(s,r,i),s}})),e.register("jM5hi",(function(r,i){t(r.exports,"makeClassname",(()=>o));var s=e("hIDiW"),n=e("hsvBG");function o(t,e,r,i){const o=Array.isArray(r)?r:[r];for(const r of o)if((0,n.isRBox)(r))(t||=(0,s.getBinder)(e)).watch(r,a);else if(r&&"object"==typeof r)for(const i in r){const o=r[i];(0,n.isRBox)(o)&&(t||=(0,s.getBinder)(e)).watch(o,a)}function a(){const t=[];for(const e of o)if(e&&"object"==typeof e)for(const r in e)(0,n.unbox)(e[r])&&t.push(r);else{const r=(0,n.unbox)(e);r&&t.push(r)}i(t.join(" "))}return a(),t}}));
//# sourceMappingURL=digger.a2ad63ba.js.map
