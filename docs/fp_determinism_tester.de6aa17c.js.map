{"mappings":"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","sources":["src/sketches/fp_determinism_tester/fp_determinism_tester.ts","node_modules/@parcel/runtime-js/lib/runtime-a3f5e19a4906ecf3.js","node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","src/sketches/fp_determinism_tester/fp_determinism_tester.module.scss"],"sourcesContent":["import {tag} from \"@nartallax/cardboard-dom\"\nimport inputDataPath from \"./input_data.txt\"\nimport * as css from \"./fp_determinism_tester.module.scss\"\n\nconst runTheTests = (testData: number[]): FullTestRunResult[] => {\n\tconst [o1, o2, o3, o4, negZero] = testData as any\n\treturn runTests([\n\t\t[\"0.1 + 0.2\", x => x + o1 + o2],\n\t\t[\"0.1 - 0.2\", x => x + o1 - o2],\n\t\t[\"0.1 * 0.2\", x => x + o1 * o2],\n\t\t[\"0.1 / 0.2\", x => x + o1 * o2],\n\t\t[\"(0.1 * 0.2) + (0.3 * 0.4)\", x => x + (o1 * o2) + (o3 * o4)],\n\t\t[\"sin(0.1) + cos(0.2)\", x => x + Math.sin(o1) + Math.cos(o2)],\n\t\t[\"sqrt(0.3) + sqrt(0.4)\", x => x + Math.sqrt(o3) + Math.sqrt(o4)],\n\t\t[\"-0\", () => negZero],\n\t\t[\"-0 + -0\", () => negZero + negZero],\n\t\t[\"-0 + 0.1 - 0.1\", x => x + negZero + o1 - o1]\n\t])\n}\n\nconst waitForFrame = () => new Promise(ok => requestAnimationFrame(ok))\n\nexport async function main(root: HTMLElement): Promise<void> {\n\tconst btn = tag({\n\t\ttag: \"button\",\n\t\tclass: css.button,\n\t\tonClick: async() => {\n\t\t\tbtn.textContent = \"Running...\"\n\t\t\tbtn.setAttribute(\"disabled\", \"disabled\")\n\t\t\tawait waitForFrame()\n\t\t\tawait waitForFrame()\n\t\t\ttry {\n\t\t\t\tconst testResults = runTheTests(data)\n\t\t\t\tconst table = makeResultsTable(testResults)\n\t\t\t\tbtn.replaceWith(table)\n\t\t\t\troot.prepend(makeCopyButton(testResults))\n\t\t\t} catch(e){\n\t\t\t\tconsole.error(e)\n\t\t\t\tbtn.textContent = \"Something failed! Whoopsie. See console output.\"\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}, [\"Loading...\"])\n\n\troot.appendChild(btn)\n\n\t// storing this behind network request to avoid static code optimization\n\tconst data = await(await fetch(inputDataPath)).json()\n\tbtn.textContent = \"Run the tests!\"\n}\n\ntype Test = [\n\tname: string,\n\trunner: (prevResult: number) => number\n]\n\ntype ShortTestRunResult = {\n\tname: string\n\tdec: string\n\tbin: string\n}\n\ntype FullTestRunResult = ShortTestRunResult & {\n\ttime: number\n}\n\ntype TestTiming = {time: number, runCount: number}\n\nconst makeCopyButton = (testResults: FullTestRunResult[]) => tag({\n\ttag: \"button\",\n\tclass: css.buttonSmall,\n\tonClick: () => {\n\t\tconst arrs = testResults.map(({\n\t\t\tname, dec, bin, time\n\t\t}) => [name, dec, bin, time])\n\t\tvoid navigator.clipboard.writeText(JSON.stringify(arrs)\n\t\t\t.replaceAll(/\\],\\[/g, \"],\\n[\")\n\t\t\t.replaceAll(/\\[\\[/g, \"[\\n[\")\n\t\t\t.replaceAll(/\\]\\]/g, \"]\\n]\")\n\t\t)\n\t}\n}, [\"Copy all of this\"])\n\nconst makeResultsTable = (data: FullTestRunResult[]): HTMLElement => {\n\treturn tag({tag: \"table\", class: css.table}, [\n\t\ttag({tag: \"tr\"}, [\n\t\t\ttag({tag: \"th\"}, [\"Name\"]),\n\t\t\ttag({tag: \"th\"}, [\"Decimal\"]),\n\t\t\ttag({tag: \"th\"}, [\"Binary\"]),\n\t\t\ttag({tag: \"th\"}, [\"Time (ms)\"])\n\t\t]),\n\t\t...data.map(({\n\t\t\tname, dec, bin, time\n\t\t}) => tag({tag: \"tr\"}, [\n\t\t\ttag({tag: \"td\"}, [name]),\n\t\t\ttag({tag: \"td\"}, [dec]),\n\t\t\ttag({tag: \"td\"}, [bin]),\n\t\t\ttag({tag: \"td\"}, [time.toFixed(10)])\n\t\t]))\n\t])\n}\n\nconst runTests = (tests: Test[]): FullTestRunResult[] => {\n\tconst coldTimings = makeTimings(tests)\n\tlet coldResults: ShortTestRunResult[]\n\tfor(let i = 0; i < 5; i++){\n\t\tcoldResults = runRoundOfTests(tests, coldTimings)\n\t}\n\n\tconst throwawayTimings = makeTimings(tests)\n\tconst now = Date.now()\n\twhile(Date.now() - now < 5000){\n\t\trunRoundOfTests(tests, throwawayTimings)\n\t}\n\n\tconst hotTimings = makeTimings(tests)\n\tlet hotResults: ShortTestRunResult[]\n\tfor(let i = 0; i < 5; i++){\n\t\thotResults = runRoundOfTests(tests, hotTimings)\n\t}\n\n\n\tconst enrichedCold = enrichWithTiming(coldResults!, coldTimings, \"(c) \")\n\tconst enrichedHot = enrichWithTiming(hotResults!, hotTimings, \"(h) \")\n\n\treturn insertAtEachNth(enrichedHot, enrichedCold, 2)\n\n}\n\nconst makeTimings = (tests: Test[]): TestTiming[] => tests.map(() => ({runCount: 0, time: 0}))\nconst enrichWithTiming = (results: ShortTestRunResult[], timings: TestTiming[], suffix?: string): FullTestRunResult[] => {\n\treturn results.map((res, index) => {\n\t\tconst timing = timings[index]!\n\t\treturn ({\n\t\t\t...res,\n\t\t\tname: !suffix ? res.name : suffix + res.name,\n\t\t\ttime: timing.time / timing.runCount\n\t\t})\n\t})\n}\n\nconst insertAtEachNth = <T>(receivingArray: T[], sourceArray: T[], n: number): T[] => {\n\tlet srcIndex = 0\n\tlet recIndex = 0\n\tconst result: T[] = new Array(receivingArray.length + sourceArray.length)\n\tfor(let i = 0; i < result.length; i++){\n\t\tresult[i] = (i % n) === 0 ? sourceArray[srcIndex++]! : receivingArray[recIndex++]!\n\t}\n\treturn result\n}\n\nconst runRoundOfTests = (tests: Test[], timing: TestTiming[]): ShortTestRunResult[] => {\n\tconst result: ShortTestRunResult[] = []\n\tconst dblBuffer = new DataView(new ArrayBuffer(8))\n\tfor(let i = 0; i < tests.length; i++){\n\t\tconst test = tests[i]!\n\t\tconst testTiming = timing[i]!\n\t\tconst startTime = performance.now()\n\t\tlet testResult = 0\n\t\tfor(let i = 0; i < 1000; i++){\n\t\t\ttestResult = test[1](testResult)\n\t\t}\n\t\ttestTiming.time += performance.now() - startTime\n\t\ttestTiming.runCount++\n\t\tconst testResultDec = testResult.toFixed(20)\n\t\tdblBuffer.setFloat64(0, testResult)\n\t\tlet testResultBin = \"\"\n\t\tfor(let i = 0; i < 8; i++){\n\t\t\tlet byteStr = dblBuffer.getUint8(i).toString(2)\n\t\t\twhile(byteStr.length < 8){\n\t\t\t\tbyteStr = \"0\" + byteStr\n\t\t\t}\n\t\t\ttestResultBin += byteStr\n\t\t}\n\t\tresult.push({name: test[0], dec: testResultDec, bin: testResultBin})\n\t}\n\treturn result\n}","module.exports = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"1L6a6\")).toString();","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;",".button,\n.buttonSmall {\n  cursor: pointer;\n  border-radius: 8px;\n  background-color: #222;\n  color: #aaa;\n}\n\n.button {\n  position: absolute;\n  left: 5vw;\n  right: 5vw;\n  top: 5vh;\n  padding: 1rem;\n  font-size: 40px;\n}\n\n.buttonSmall {\n  width: 90vw;\n  margin: 1rem 5vw;\n  padding: 0.5rem;\n}\n\n.table {\n  color: #aaa;\n  border-spacing: 0;\n  border-collapse: collapse;\n  margin: auto;\n\n  th {\n    background-color: #444;\n    border: 1px solid #555;\n    font-weight: bold;\n    padding: 2px;\n  }\n\n  td {\n    background-color: #222;\n    border: 1px solid #555;\n    text-align: left;\n    padding: 2px 4px;\n  }\n}\n"],"names":["$7sHgZ","parcelRequire","$13ef1059f6997794$var$waitForFrame","Promise","ok","requestAnimationFrame","async","$13ef1059f6997794$export$f22da7240b7add18","root","btn","tag","class","$4le4a","button","onClick","textContent","setAttribute","testResults","testData","o1","o2","o3","o4","negZero","$13ef1059f6997794$var$runTests","x","Math","sin","cos","sqrt","$13ef1059f6997794$var$runTheTests","data","table","$13ef1059f6997794$var$makeResultsTable","replaceWith","prepend","$13ef1059f6997794$var$makeCopyButton","e","console","error","appendChild","fetch","$parcel$interopDefault","$8xvCO","json","buttonSmall","arrs","map","name","dec","bin","time","navigator","clipboard","writeText","JSON","stringify","replaceAll","toFixed","tests","coldTimings","$13ef1059f6997794$var$makeTimings","coldResults","i","$13ef1059f6997794$var$runRoundOfTests","throwawayTimings","now","Date","hotTimings","hotResults","i1","enrichedCold","$13ef1059f6997794$var$enrichWithTiming","enrichedHot","$13ef1059f6997794$var$insertAtEachNth","runCount","results","timings","suffix","res","index","timing","receivingArray","sourceArray","n","srcIndex","recIndex","result","Array","length","dblBuffer","DataView","ArrayBuffer","test","testTiming","startTime","performance","testResult","testResultDec","setFloat64","testResultBin","i2","byteStr","getUint8","toString","push","module","exports","URL","resolve","import","meta","url","$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","id","resolved","Error","$329408dd30245791$export$48710ed2dec0d923","$329408dd30245791$export$9852986a3ec5f6a0","$329408dd30245791$export$2ba01fb71ed41cb6"],"version":3,"file":"fp_determinism_tester.de6aa17c.js.map"}