function t(t,e,i,r){Object.defineProperty(t,e,{get:i,set:r,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirebf86;e.register("hppz9",(function(i,r){t(i.exports,"main",(()=>n));var s=e("d1Qaj");async function n(t){const e={widthCells:15,heightCells:10,screenWidth:document.body.clientWidth,screenHeight:document.body.clientHeight,wallThickness:.1,colors:{terrainA:"#d45500",terrainB:"#aa4400",terrainEmpty:"#2b1100"},dramaticDrawTiming:{terrain:.5}},i=new(0,s.DiggerWorld)(e);t.appendChild(i.el),i.start(),i.digVertical(0,0,5),i.digVertical(0,0,4)}})),e.register("d1Qaj",(function(i,r){t(i.exports,"DiggerWorld",(()=>c));var s=e("1VHh9"),n=e("cZ4Y3"),o=e("aCP3q");let a;var l;(l=a||(a={}))[l.DramaticDrawTerrain=0]="DramaticDrawTerrain",l[l.Running=1]="Running";class c{constructor(t){this.options=t,this.state=a.Running,this.dramaticDrawProgress=0,this.raf=null,this.invalidatedRects=new(0,n.RectanlgeDeduplicator);const e=t.screenWidth/t.widthCells,i=t.screenHeight/(t.heightCells+1);this.cellSizePx=Math.floor(Math.min(e,i));const r=t.screenWidth-this.cellSizePx*t.widthCells;this.soilMarginLeft=Math.ceil(r/2),this.playgroundWidthPx=t.widthCells*this.cellSizePx,this.terrain=new(0,s.Bitmap)(this.cellSizePx**2*t.widthCells*t.heightCells),this.terrain.setAll(),this.el=(0,o.tag)({tagName:"canvas",attrs:{width:t.screenWidth,height:t.screenHeight}});const l=this.el.getContext("2d");if(!l)throw new Error("Browser can't canvas 2d");if(this.context=l,!requestAnimationFrame)throw new Error("Browser can't RAF")}drawTerrainPixelAt(t,e,i){this.context.fillStyle,this.context.fillStyle=i?((15&e)>8?(e+t&15)>8:(e-t&15)<8)?this.options.colors.terrainA:this.options.colors.terrainB:this.options.colors.terrainEmpty,this.context.fillRect(t,e,1,1)}redrawTerrainAt(t,e){this.drawTerrainPixelAt(t+this.soilMarginLeft,e+this.cellSizePx,this.terrain.get(e*this.playgroundWidthPx+t))}dramaticDrawInitialTerrain(t){const e=this.dramaticDrawProgress,i=this.options.screenWidth*(this.options.screenHeight-this.cellSizePx),r=i/this.options.dramaticDrawTiming.terrain,s=Math.floor(t*r);this.dramaticDrawProgress=Math.min(i,this.dramaticDrawProgress+s);for(let t=e;t<this.dramaticDrawProgress;t++){const e=t%this.options.screenWidth,i=(t-e)/this.options.screenWidth+this.cellSizePx;this.drawTerrainPixelAt(e,i,!0)}this.dramaticDrawProgress===i&&(this.state=a.Running,this.dramaticDrawProgress=0)}invalidate(t,e,i,r){this.invalidatedRects.add({x:t,y:e,w:i,h:r})}redrawInvalidatedRectangles(){for(const t of this.invalidatedRects.getNonIntersectingRects()){const e=t.x+t.w,i=t.y+t.h;for(let r=t.x;r<e;r++)for(let e=t.y;e<i;e++)this.redrawTerrainAt(r,e)}this.invalidatedRects.clear()}onTick(t){switch(this.state){case a.DramaticDrawTerrain:return void this.dramaticDrawInitialTerrain(t);case a.Running:return void this.redrawInvalidatedRectangles()}}reset(){this.state=a.DramaticDrawTerrain,this.dramaticDrawProgress=0}start(){if(this.raf)throw new Error("Already started");this.reset();let t=0;const e=i=>{this.raf=requestAnimationFrame(e);const r=Math.min(1e3/15,i-t)/1e3;t=i,this.onTick(r)};e(t)}stop(){if(!this.raf)throw new Error("Not started");cancelAnimationFrame(this.raf),this.raf=null}digVertical(t,e,i){if(e>i){i=e,e=e}const r=this.cellSizePx*(1-this.options.wallThickness),s=t*this.cellSizePx-r/2,n=s+r,o=e*this.cellSizePx,a=i*this.cellSizePx;for(let t=o;t<=a;t++){const e=t*this.playgroundWidthPx;for(let t=s;t<=n;t++)this.terrain.clear(e+t)}this.invalidate(s,o,n-s,a-o)}}})),e.register("1VHh9",(function(e,i){t(e.exports,"Bitmap",(()=>r));class r{constructor(t){if(this.size=t,t<0)throw new Error(`Expected non-negative as size, got ${t}`);t%8&&(t=8*Math.ceil(t/8)),this.arr=new Uint8Array(t>>3)}set(t){const e=this.arr,i=t>>3;e[i]=e[i]|1<<(7&t)}clear(t){const e=this.arr,i=t>>3;e[i]=e[i]&~(1<<(7&t))}get(t){return 0!=(this.arr[t>>3]&1<<(7&t))}setAll(){for(let t=0;t<this.arr.length;t++)this.arr[t]=255}clearAll(){for(let t=0;t<this.arr.length;t++)this.arr[t]=0}}})),e.register("cZ4Y3",(function(e,i){t(e.exports,"RectanlgeDeduplicator",(()=>r));class r{rects=[];add(t){this.rects.push(t)}clear(){this.rects.length=0}*getNonIntersectingRects(){for(const t of this.groupByLumps()){const e=[...this.splitLump(t)];yield*l(e)}}*groupByLumps(){for(const t of s(this.rects,n("y","h")))yield*s(t,n("x","w"))}*splitLump(t){const e=o(t,"x","w"),i=o(t,"y","h");for(const r of t)for(const t of a(r,e,"x","w"))yield*a(t,i,"y","h")}}function*s(t,e){if(0===t.length)return;let i=t[0],r=[i],s=null;for(let n=1;n<t.length;n++){const o=t[n];s=e(i,o,s),s?r.push(o):(yield r,r=[o]),i=o}yield r}function n(t,e){return(i,r,s)=>{const n=s?s.a:i[t],o=s?s.b:i[t]+i[e];return r[t]+r[e]<n||r[t]>o?null:{a:Math.min(n,r[t]),b:Math.max(o,r[t]+r[e])}}}function o(t,e,i){const r=[];for(let s=0;s<t.length;s++){const n=t[s],o=n[e];r.push(o,o+n[i])}return r.sort(((t,e)=>t-e))}function*a(t,e,i,r){let s=e[0];for(let n=1;n<e.length;n++){const o=e[n];if(o===s)continue;const a=t[i];if(s<a)o>a&&(yield{...t,[r]:o-a});else{const e=t[r];if(!(o<a+e)){yield{...t,[i]:s,[r]:a+e-s};break}yield{...t,[i]:s,[r]:o-s}}s=o}}function*l(t){if(t.length<1)return;let e=(t=t.sort(((t,e)=>t.x-e.x||t.y-e.y)))[0];if(yield e,!(t.length<2))for(let i=1;i<t.length;i++){const r=t[i];r.x===e.x&&r.y===e.y&&r.h===e.h&&r.w===e.w||(yield r,e=r)}}})),e.register("aCP3q",(function(i,r){t(i.exports,"tag",(()=>c)),t(i.exports,"svgTag",(()=>h));var s=e("hIDiW"),n=e("hsvBG"),o=e("jM5hi");function a(t,e){return t?Array.isArray(t)||(0,n.isRBox)(t)?[{},t]:[t,e]:[{},e]}function l(t,e,i){let r=null;if(e.text){const i=e.text;(0,n.isRBox)(i)&&(r||=(0,s.getBinder)(t)).watch(i,(e=>{t.textContent=e+""})),t.textContent=(0,n.unbox)(i)+""}if(e.on)for(const i in e.on){const r=e.on[i];t.addEventListener(i,r,{passive:!0,capture:!1})}for(const i in e.attrs){const o=e.attrs[i];(0,n.isRBox)(o)&&(r||=(0,s.getBinder)(t)).watch(o,(e=>{null==e?t.removeAttribute(i):t.setAttribute(i,e+"")}));const a=(0,n.unbox)(o);null!=o&&t.setAttribute(i,a+"")}if(i){const e=e=>{const i=e.filter((t=>!!t));!function(t,e){for(let i=0;i<e.length;i++){const r=e[i],s=t.childNodes[i];s!==r&&(s?t.insertBefore(r,s):t.appendChild(r))}for(;t.childNodes[e.length];)t.childNodes[e.length].remove()}(t,i)};(0,n.isRBox)(i)&&(r||=(0,s.getBinder)(t)).watch(i,(t=>{e(t)})),e((0,n.unbox)(i))}return e.class&&(r=(0,o.makeClassname)(r,t,e.class,(e=>t.classList.value=e))||r),r}function c(t,e){const[i,r]=a(t,e),o=document.createElement(i.tagName||"div");let c=l(o,i,r);if(i.style)for(const t in i.style){const e=i.style[t];(0,n.isRBox)(e)&&(c||=(0,s.getBinder)(o)).watch(e,(e=>{o.style[t]=e+""})),o.style[t]=(0,n.unbox)(i.style[t])+""}return o}function h(t,e){const[i,r]=a(t,e),s=document.createElementNS("http://www.w3.org/2000/svg",i.tagName||"g");return"svg"===i.tagName&&s.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),l(s,i,r),s}})),e.register("jM5hi",(function(i,r){t(i.exports,"makeClassname",(()=>o));var s=e("hIDiW"),n=e("hsvBG");function o(t,e,i,r){const o=Array.isArray(i)?i:[i];for(const i of o)if((0,n.isRBox)(i))(t||=(0,s.getBinder)(e)).watch(i,a);else if(i&&"object"==typeof i)for(const r in i){const o=i[r];(0,n.isRBox)(o)&&(t||=(0,s.getBinder)(e)).watch(o,a)}function a(){const t=[];for(const e of o)if(e&&"object"==typeof e)for(const i in e)(0,n.unbox)(e[i])&&t.push(i);else{const i=(0,n.unbox)(e);i&&t.push(i)}r(t.join(" "))}return a(),t}}));
//# sourceMappingURL=digger.f4382914.js.map
